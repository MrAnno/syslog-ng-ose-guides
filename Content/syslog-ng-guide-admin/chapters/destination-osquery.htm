<?xml version="1.0" encoding="UTF-8"?>

 %entities;]&gt;
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><body name="configuring-destinations-osquery" oldrole="section">
<h1 name="configuring-destinations-osquery" oldrole="section"><span class="Code" oldrole="parameter">osquery</span>: Sending log messages to osquery's syslog table</h1>
<p oldrole="para">The <span class="Code" oldrole="parameter">osquery()</span> driver sends log messages to osquery's syslog table.</p>
<p oldrole="para">The syslog table contains logs forwarded over a named pipe from syslog-ng. When an osquery process that supports the syslog table starts up, it creates (and properly sets permissions for) a named pipe for syslog-ng to write to.</p>

<h6 oldrole="example">Example: Using the osquery() destination driver</h6>
<p oldrole="para">Run osqueryi:</p>
<pre class="Code" oldrole="synopsis">osqueryi --enable_syslog
         --disable-events=false</pre>
<p oldrole="para">To store the database on disk:</p>
<pre class="Code" oldrole="synopsis">osqueryi --enable_syslog
         --disable-events=false
         <i oldrole="emphasis" role="bold">--database_path=/tmp/osquery.db</i></pre>
<p oldrole="para">To set up a custom named pipe:</p>
<pre class="Code" oldrole="synopsis">osqueryi --enable_syslog
         --disable-events=false
         --database_path=/tmp/osquery.db
         <i oldrole="emphasis" role="bold">--syslog_pipe_path=/tmp/osq.pipe</i></pre>
<p oldrole="para">Example configuration:</p>
<pre class="Code" oldrole="synopsis">@version: 3.12
@include "scl.conf"

source s_net {
  network(port(5514));
};

destination d_osquery {
  # custom pipe path:
  #osquery(pipe("/tmp/osq.pipe"));

  # backup outgoing logs:
  #osquery(file("/var/log/osquery_inserts.log" template(t_osquery)));

  # defaults
  osquery();
};

log {
 source(s_net);
 destination(d_osquery);
 flags(flow-control);
};</pre>


<h2 name="options-osquery">osquery() destination options</h2>
<MadCap:keyword term="destination drivers:[&lt;span class=&quot;Code&quot; oldrole=&quot;parameter&quot;&gt;osquery()&lt;/span&gt;, ' driver']"></MadCap:keyword>
<p oldrole="para">The <span class="Code" oldrole="parameter">osquery()</span> destination has the following options:</p>

<h6 oldrole="simplesect">file()</h6>
<MadCap:keyword term="file()"></MadCap:keyword>
<table cellspacing="0" class="RuledTableWithHeading_DoNotEdit" colsep="0" frame="topbot" rowsep="0" style="width: 100%;mc-table-style: url('../../Resources/TableStyles/RuledTableWithHeading_DoNotEdit.css');">


<tbody>
<tr class="TableStyle-RuledTableWithHeading_DoNotEdit-Body-Body1">
<td class="TableStyle-RuledTableWithHeading_DoNotEdit-Body-Body1">Type:</td>
<td class="TableStyle-RuledTableWithHeading_DoNotEdit-Body-Body1">string</td>
</tr>
<tr class="TableStyle-RuledTableWithHeading_DoNotEdit-Body-Body1">
<td class="TableStyle-RuledTableWithHeading_DoNotEdit-Body-Body1">Default:</td>
<td class="TableStyle-RuledTableWithHeading_DoNotEdit-Body-Body1">N/A</td>
</tr>
</tbody>

<col class="TableStyle-RuledTableWithHeading_DoNotEdit-Column-Column1" style="width: 0.3in;"></col></table>
<p oldrole="para"><i oldrole="emphasis" role="bold">Description:</i> Specifies a path to the file where log messages are stored, for example, for debug purposes.</p>
<p oldrole="para">Specifying this option is optional. However, when you start losing logs for some reason, then it is recommended to write outgoing log messages to a specified file, in the same format that messages are written to the pipe. You can also use a <span class="Code" oldrole="userinput">template()</span> function called <span class="Code" oldrole="userinput">t_osquery</span>, which re-formats messages so they comply with the text-based protocol that osquery accepts.</p>

<simplesect>
<title>pipe()</title>
<indexterm type="parameter">
<primary>pipe()</primary>
</indexterm>
<table cellspacing="0" class="RuledTableWithHeading_DoNotEdit" colsep="0" frame="topbot" rowsep="0" style="width: 100%;mc-table-style: url('../../Resources/TableStyles/RuledTableWithHeading_DoNotEdit.css');">


<tbody>
<tr class="TableStyle-RuledTableWithHeading_DoNotEdit-Body-Body1">
<td class="TableStyle-RuledTableWithHeading_DoNotEdit-Body-Body1">Type:</td>
<td class="TableStyle-RuledTableWithHeading_DoNotEdit-Body-Body1">string</td>
</tr>
<tr class="TableStyle-RuledTableWithHeading_DoNotEdit-Body-Body1">
<td class="TableStyle-RuledTableWithHeading_DoNotEdit-Body-Body1">Default:</td>
<td class="TableStyle-RuledTableWithHeading_DoNotEdit-Body-Body1">N/A</td>
</tr>
</tbody>

<col class="TableStyle-RuledTableWithHeading_DoNotEdit-Column-Column1" style="width: 0.3in;"></col></table>
<p oldrole="para"><i oldrole="emphasis" role="bold">Description:</i> Specifies a custom path to the named pipe that acts as the interface between osquery and syslog-ng. (The default path is set in the SCL file.)</p>
<p oldrole="para">Specifying this option is optional.</p>
</simplesect>

</body></html>
