<?xml version="1.0" encoding="UTF-8"?>

<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><body name="configuring-destinations-mongodb" oldrole="section">
<h1 name="configuring-destinations-mongodb" oldrole="section"><span class="Code" oldrole="parameter">mongodb</span>: Storing messages in a MongoDB database</h1>
<MadCap:keyword term="destination drivers:[&lt;span class=&quot;Code&quot; oldrole=&quot;parameter&quot;&gt;mongodb()&lt;/span&gt;, ' driver']"></MadCap:keyword>
<p oldrole="para">The <span class="Code" oldrole="parameter">mongodb()</span> driver sends messages to a <a href="https://www.mongodb.com/">MongoDB</a> database. MongoDB is a schema-free, document-oriented database. For the list of available optional parameters, see <xref linkend="reference-destination-mongodb"></xref>.</p>

<h6 oldrole="formalpara">Declaration:</h6>
<p oldrole="para"></p>

<pre class="Code" oldrole="synopsis">mongodb(parameters);</pre>
<p oldrole="para">The <span class="Code" oldrole="parameter">mongodb()</span> driver does not support creating indexes, as that can be a very complex operation in MongoDB. If needed, the administrator of the MongoDB database must ensure that indexes are created on the collections.</p>
<p oldrole="para">The <span class="Code" oldrole="parameter">mongodb()</span> driver does not add the <span class="Code" oldrole="userinput">_id</span> field to the message: the MongoDB server will do that automatically, if none is present. If you want to override this field from <entity>abbrev</entity>, use the <span class="Code" oldrole="parameter">key()</span> parameter of the <span class="Code" oldrole="parameter">value-pairs()</span> option.</p>
<p oldrole="para">The <entity>abbrev</entity> <span class="Code" oldrole="parameter">mongodb()</span> driver is compatible with MongoDB server version 1.4 and newer.</p>
<MadCap:snippetBlock src="../../shared/wnt/note-typehinting.htm"></MadCap:snippetBlock>
<example xml:id="example-destination-mongodb">
<title>Using the mongodb() driver</title>
<p oldrole="para">The following example creates a <span class="Code" oldrole="parameter">mongodb()</span> destination using only default values.</p>
<pre class="Code" oldrole="synopsis">destination d_mongodb {
    mongodb();
};</pre>
<p oldrole="para">The following example displays the default values.</p>
<pre class="Code" oldrole="synopsis">destination d_mongodb {
    mongodb(
        uri("mongodb://localhost:27017/syslog")
        collection("messages")
        value-pairs(
            scope("selected-macros" "nv-pairs" "sdata")
        )
    );
};</pre>
<p oldrole="para">The following example shows the same setup using the deprecated libmongo-client syntax (as used in <entity>abbrev</entity> version <phrase condition="ose">3.7</phrase>), and is equivalent with the previous example.</p>
<pre class="Code" oldrole="synopsis">destination d_mongodb {
    mongodb(
        servers("localhost:27017")
        database("syslog")
        collection("messages")
        value-pairs(
            scope("selected-macros" "nv-pairs" "sdata")
        )
    );
};</pre>
</example>
<MadCap:snippetBlock src="mongodb-connecting-server.htm"></MadCap:snippetBlock>

<h2 name="reference-destination-mongodb">mongodb() destination options</h2>
<indexterm>
<primary>destination drivers</primary>
<secondary><span class="Code" oldrole="parameter">mongodb()</span> driver</secondary>
</indexterm>
<p oldrole="para">The <span class="Code" oldrole="parameter">mongodb()</span> driver sends messages to a MongoDB database. MongoDB is a schema-free, document-oriented database.</p>
<p oldrole="para">The <span class="Code" oldrole="parameter">mongodb()</span> destination has the following options:</p>
<simplesect xml:id="mongodb-option-collection">
<title>collection()</title>
<indexterm type="parameter">
<primary>collection()</primary>
</indexterm>
<informaltable colsep="0" frame="topbot" rowsep="0">
<tgroup cols="2">
<colspec colnum="1" colwidth="40pt"></colspec>
<tbody>
<row>
<entry>Type:</entry>
<entry>string</entry>
</row>
<row>
<entry>Default:</entry>
<entry>messages</entry>
</row>
</tbody>
</tgroup>
</informaltable>
<p oldrole="para"><i oldrole="emphasis" role="bold">Description:</i> The name of the MongoDB collection where the log messages are stored (collections are similar to SQL tables). Note that the name of the collection must not start with a dollar sign ($), and that it may contain dot (.) characters.</p>
<table cellspacing="0" class="TableStyle-NoteTable_Yellow_DoNotEdit" oldrole="warning" style="width: 100%;mc-table-style: url('../../Resources/TableStyles/NoteTable_Yellow_DoNotEdit.css');"><col class="TableStyle-NoteTable_Yellow_DoNotEdit-Column-Column1" style="width: 0.3in;"></col><col class="TableStyle-NoteTable_Yellow_DoNotEdit-Column-Column2"></col><tbody><tr class="TableStyle-NoteTable_Yellow_DoNotEdit-Body-Body1"><td class="TableStyle-NoteTable_Yellow_DoNotEdit-BodyB-Column1-Body1"><p><img src="../../Resources/Images/Common/caution.png"/></p></td><td class="TableStyle-NoteTable_Yellow_DoNotEdit-BodyA-Column2-Body1"><span class="Yellow">Caution: </span><p oldrole="para">Hazard of data loss! The <entity>abbrev</entity> application does not verify that the specified collection name does not contain invalid characters. If you specify a collection with an invalid name, the log messages sent to the MongoDB database will be irrevocably lost without any warning.</p></td></tr></tbody></table>
</simplesect>
<simplesect xml:id="mongodb-option-database">
<title>database() (DEPRECATED)</title>
<indexterm type="parameter">
<primary>database()</primary>
</indexterm>
<informaltable colsep="0" frame="topbot" rowsep="0">
<tgroup cols="2">
<colspec colnum="1" colwidth="40pt"></colspec>
<tbody>
<row>
<entry>Type:</entry>
<entry>string</entry>
</row>
<row>
<entry>Default:</entry>
<entry>syslog</entry>
</row>
</tbody>
</tgroup>
</informaltable>
<p oldrole="para">This option is deprecated and will be removed from <entity>abbrev</entity>. Use the <a href="destination-mongodb.htm"><span class="Code" oldrole="parameter">uri()</span></a> option instead.</p>
<p oldrole="para"><i oldrole="emphasis" role="bold">Description:</i> The name of the MongoDB database where the log messages are stored. Note that the name of the database must not start with a dollar sign ($) and it cannot contain dot (.) characters.</p>
<table cellspacing="0" class="TableStyle-NoteTable_Yellow_DoNotEdit" oldrole="warning" style="width: 100%;mc-table-style: url('../../Resources/TableStyles/NoteTable_Yellow_DoNotEdit.css');"><col class="TableStyle-NoteTable_Yellow_DoNotEdit-Column-Column1" style="width: 0.3in;"></col><col class="TableStyle-NoteTable_Yellow_DoNotEdit-Column-Column2"></col><tbody><tr class="TableStyle-NoteTable_Yellow_DoNotEdit-Body-Body1"><td class="TableStyle-NoteTable_Yellow_DoNotEdit-BodyB-Column1-Body1"><p><img src="../../Resources/Images/Common/caution.png"/></p></td><td class="TableStyle-NoteTable_Yellow_DoNotEdit-BodyA-Column2-Body1"><span class="Yellow">Caution: </span><p oldrole="para">Hazard of data loss! The <entity>abbrev</entity> application does not verify that the specified database name does not contain invalid characters. If you specify a database with an invalid name, the log messages sent to the MongoDB database will be irrevocably lost without any warning.</p></td></tr></tbody></table>
</simplesect>
<simplesect>
<MadCap:snippetBlock src="../../shared/chunk/option-destination-diskbuffer.htm"></MadCap:snippetBlock>
</simplesect>
<simplesect>
<MadCap:snippetBlock src="../../shared/chunk/option-destination-frac-digits.htm"></MadCap:snippetBlock>
</simplesect>
<simplesect>
<MadCap:snippetBlock src="../../shared/chunk/option-destination-local-timezone.htm"></MadCap:snippetBlock>
</simplesect>
<simplesect>
<MadCap:snippetBlock src="../../shared/chunk/option-destination-log-fifo-size.htm"></MadCap:snippetBlock>
</simplesect>
<simplesect xml:id="mongodb-option-typecasting-on-error">
<MadCap:snippetBlock src="../../shared/chunk/option-destination-on-error.htm"></MadCap:snippetBlock>
</simplesect>
<simplesect xml:id="mongodb-option-password">
<title>password() (DEPRECATED)</title>
<indexterm type="parameter">
<primary>password()</primary>
</indexterm>
<informaltable colsep="0" frame="topbot" rowsep="0">
<tgroup cols="2">
<colspec colnum="1" colwidth="40pt"></colspec>
<tbody>
<row>
<entry>Type:</entry>
<entry>string</entry>
</row>
<row>
<entry>Default:</entry>
<entry>n/a</entry>
</row>
</tbody>
</tgroup>
</informaltable>
<p oldrole="para">This option is deprecated and will be removed from <entity>abbrev</entity>. Use the <a href="destination-mongodb.htm"><span class="Code" oldrole="parameter">uri()</span></a> option instead.</p>
<p oldrole="para"><i oldrole="emphasis" role="bold">Description:</i> Password of the database user.</p>
</simplesect>
<simplesect xml:id="mongodb-option-path">
<title>path() (DEPRECATED)</title>
<indexterm type="parameter">
<primary>path()</primary>
</indexterm>
<informaltable colsep="0" frame="topbot" rowsep="0">
<tgroup cols="2">
<colspec colnum="1" colwidth="40pt"></colspec>
<tbody>
<row>
<entry>Type:</entry>
<entry>string</entry>
</row>
<row>
<entry>Default:</entry>
<entry>empty</entry>
</row>
</tbody>
</tgroup>
</informaltable>
<p oldrole="para">This option is deprecated and will be removed from <entity>abbrev</entity>. Use the <a href="destination-mongodb.htm"><span class="Code" oldrole="parameter">uri()</span></a> option instead.</p>
<p oldrole="para"><i oldrole="emphasis" role="bold">Description:</i> If the <span class="Code" oldrole="parameter">path()</span> option is set, <entity>abbrev</entity> will connect to the database using the specified UNIX domain socket. Note that you cannot set the <span class="Code" oldrole="parameter">path()</span> and the <span class="Code" oldrole="parameter">servers()</span> options at the same time.</p>
</simplesect>
<simplesect xml:id="mongodb-option-retries">
<MadCap:snippetBlock src="../../shared/chunk/option-destination-retries.htm"></MadCap:snippetBlock>
<p oldrole="para">For MongoDB operations, <entity>abbrev</entity> uses a one-minute timeout: if an operation times out, <entity>abbrev</entity> assumes the operation has failed.</p>
</simplesect>
<simplesect xml:id="mongodb-option-safe-mode">
<title>safe-mode() (DEPRECATED)</title>
<indexterm type="parameter">
<primary>safe-mode()</primary>
</indexterm>
<indexterm>
<primary>safe_mode()</primary>
</indexterm>
<informaltable colsep="0" frame="topbot" rowsep="0">
<tgroup cols="2">
<colspec colnum="1" colwidth="40pt"></colspec>
<tbody>
<row>
<entry>Type:</entry>
<entry>yes or no</entry>
</row>
<row>
<entry>Default:</entry>
<entry>yes</entry>
</row>
</tbody>
</tgroup>
</informaltable>
<p oldrole="para">This option is deprecated and will be removed from <entity>abbrev</entity>. Use the <a href="destination-mongodb.htm"><span class="Code" oldrole="parameter">uri()</span></a> option instead.</p>
<p oldrole="para"><i oldrole="emphasis" role="bold">Description:</i> If <span class="Code" oldrole="parameter">safe-mode()</span> is enabled, <entity>abbrev</entity> performs an extra check after each insert to verify that the insert succeeded. The insert is successful only if this second check is successful. Note that enabling this option reduces the performance of the driver.</p>
</simplesect>
<simplesect xml:id="mongodb-option-servers">
<title>servers() (DEPRECATED)</title>
<indexterm type="parameter">
<primary>servers()</primary>
</indexterm>
<informaltable colsep="0" frame="topbot" rowsep="0">
<tgroup cols="2">
<colspec colnum="1" colwidth="40pt"></colspec>
<tbody>
<row>
<entry>Type:</entry>
<entry>list of hostname:port pairs</entry>
</row>
<row>
<entry>Default:</entry>
<entry>127.0.0.1:27017</entry>
</row>
</tbody>
</tgroup>
</informaltable>
<p oldrole="para">This option is deprecated and will be removed from <entity>abbrev</entity>. Use the <a href="destination-mongodb.htm"><span class="Code" oldrole="parameter">uri()</span></a> option instead.</p>
<p oldrole="para"><i oldrole="emphasis" role="bold">Description:</i> Specifies the hostname or IP address and the port number of the database server. When specifying an IP address, IPv4 (for example, <span class="Code" oldrole="userinput">192.168.0.1</span>) or IPv6 (for example, <span class="Code" oldrole="userinput">[::1]</span>) can be used as well.</p>
<p oldrole="para">To send the messages to a MongoDB replicaset, specify the addresses of the database servers as a comma-separated list, for example: <span class="Code" oldrole="userinput">servers(192.168.1.1:27017,192.168.3.3:27017)</span></p>
<p oldrole="para">For details on how <entity>abbrev</entity> connects the MongoDB server, see <xref linkend="mongodb-connecting-server"></xref>.</p>
<p oldrole="para">To connect to the server using a UNIX domain socket, use <a href="destination-mongodb.htm">path</a> option. Note that you cannot set the <span class="Code" oldrole="parameter">path()</span> and the <span class="Code" oldrole="parameter">servers()</span> options at the same time.</p>
</simplesect>
<simplesect>
<MadCap:snippetBlock src="../../shared/chunk/option-destination-throttle.htm"></MadCap:snippetBlock>
</simplesect>
<simplesect xml:id="mongodb-option-uri">
<title>uri()</title>
<indexterm type="parameter">
<primary>uri()</primary>
</indexterm>
<informaltable colsep="0" frame="topbot" rowsep="0">
<tgroup cols="2">
<colspec colnum="1" colwidth="40pt"></colspec>
<tbody>
<row>
<entry>Type:</entry>
<entry>string</entry>
</row>
<row>
<entry>Default:</entry>
<entry>mongodb://127.0.0.1:27017/syslog?wtimeoutMS=60000&amp;socketTimeoutMS=60000&amp;connectTimeoutMS=60000</entry>
</row>
</tbody>
</tgroup>
</informaltable>
<p oldrole="para"><i oldrole="emphasis" role="bold">Description:</i> Available in syslog-ng OSE 3.8 and later. Please refer to the <a href="https://docs.mongodb.com/manual/reference/connection-string/">MongoDB URI format documentation</a> for detailed syntax.</p>
</simplesect>
<simplesect xml:id="mongodb-option-username">
<title>username() (DEPRECATED)</title>
<indexterm type="parameter">
<primary>username()</primary>
</indexterm>
<informaltable colsep="0" frame="topbot" rowsep="0">
<tgroup cols="2">
<colspec colnum="1" colwidth="40pt"></colspec>
<tbody>
<row>
<entry>Type:</entry>
<entry>string</entry>
</row>
<row>
<entry>Default:</entry>
<entry>n/a</entry>
</row>
</tbody>
</tgroup>
</informaltable>
<p oldrole="para">This option is deprecated and will be removed from <entity>abbrev</entity>. Use the <a href="destination-mongodb.htm"><span class="Code" oldrole="parameter">uri()</span></a> option instead.</p>
<p oldrole="para"><i oldrole="emphasis" role="bold">Description:</i> Name of the database user. Note that the <span class="Code" oldrole="parameter">mongodb()</span> driver currently does not support TLS-encrypted authentication.</p>
</simplesect>
<!--            FIXME not supported in OSE 3.4, but will be in 3.6 > check 3.6 code if it is really supported
                <simplesect>
                    <xi:include href="../../shared/chunk/option-destination-timezone.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
                </simplesect>
-->
<simplesect>
<MadCap:snippetBlock src="../../shared/chunk/destination-option-value-pairs-content.htm"></MadCap:snippetBlock>
<MadCap:snippetBlock src="../../shared/wnt/note-typehinting.htm"></MadCap:snippetBlock>
</simplesect>

</body></html>
