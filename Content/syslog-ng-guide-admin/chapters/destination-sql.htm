<?xml version="1.0" encoding="UTF-8"?>

 %entities;]&gt;
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><body name="configuring-destinations-sql" oldrole="section">
<h1 name="configuring-destinations-sql" oldrole="section"><span class="Code" oldrole="parameter">sql</span>: Storing messages in an SQL database</h1>
<MadCap:keyword term="destination drivers:[&lt;span class=&quot;Code&quot; oldrole=&quot;parameter&quot;&gt;sql()&lt;/span&gt;, ' driver']"></MadCap:keyword>
<MadCap:keyword term="destination drivers:['database driver']"></MadCap:keyword>
<MadCap:keyword term="sql destinations"></MadCap:keyword>
<p oldrole="para">The <span class="Code" oldrole="parameter">sql()</span> driver sends messages into an SQL database. Currently the Microsoft SQL (MSSQL), MySQL, Oracle, PostgreSQL, and SQLite databases are supported.</p>

<p><b oldrole="formalpara">Declaration:</b></p>


<pre class="Code" oldrole="synopsis">sql(database_type host_parameters database_parameters [options]);</pre>
<p oldrole="para">The <span class="Code" oldrole="parameter">sql()</span> driver has the following required parameters: <a href="destination-sql.htm"><span class="Code" oldrole="parameter">type()</span></a>, <a href="destination-sql.htm"><span class="Code" oldrole="parameter">database()</span></a>, <a href="destination-sql.htm"><span class="Code" oldrole="parameter">table()</span></a>, <a href="destination-sql.htm"><span class="Code" oldrole="parameter">columns()</span></a>, and <a href="destination-sql.htm"><span class="Code" oldrole="parameter">values()</span></a>.</p>
<table cellspacing="0" class="TableStyle-NoteTable_Yellow_DoNotEdit" oldrole="warning" style="width: 100%;mc-table-style: url('../../Resources/TableStyles/NoteTable_Yellow_DoNotEdit.css');"><col class="TableStyle-NoteTable_Yellow_DoNotEdit-Column-Column1" style="width: 0.3in;"></col><col class="TableStyle-NoteTable_Yellow_DoNotEdit-Column-Column2"></col><tbody><tr class="TableStyle-NoteTable_Yellow_DoNotEdit-Body-Body1"><td class="TableStyle-NoteTable_Yellow_DoNotEdit-BodyB-Column1-Body1"><p><img src="../../Resources/Images/Common/caution.png"/></p></td><td class="TableStyle-NoteTable_Yellow_DoNotEdit-BodyA-Column2-Body1"><span class="Yellow">Caution: </span><p oldrole="para">The syslog-ng application requires read and write access to the SQL table, otherwise it cannot verify that the destination table exists.</p><p oldrole="para">Currently the syslog-ng application has default schemas for the different databases and uses these defaults if the database schema (for example columns and column types) is not defined in the configuration file. However, these schemas will be deprecated and specifying the exact database schema will be required in later versions of syslog-ng.</p></td></tr></tbody></table>
<table cellspacing="0" class="TableStyle-NoteTable_Blue_DoNotEdit" oldrole="note" style="width: 100%;mc-table-style: url('../../Resources/TableStyles/NoteTable_Blue_DoNotEdit.css');"><col class="TableStyle-NoteTable_Blue_DoNotEdit-Column-Column1" style="width: 0.3in;"></col><col class="TableStyle-NoteTable_Blue_DoNotEdit-Column-Column2"></col><tbody><tr class="TableStyle-NoteTable_Blue_DoNotEdit-Body-Body1"><td class="TableStyle-NoteTable_Blue_DoNotEdit-BodyB-Column1-Body1"><p><img src="../../Resources/Images/Common/note.png"/></p></td><td class="TableStyle-NoteTable_Blue_DoNotEdit-BodyA-Column2-Body1"><span class="AllNoteStyles">NOTE: </span><p oldrole="para">In addition to the standard syslog-ng packages, the <span class="Code" oldrole="parameter">sql()</span> destination requires database-specific packages to be installed. These packages are automatically installed by the binary syslog-ng installer.</p></td></tr></tbody></table>
<p oldrole="para">The <span class="Code" oldrole="parameter">table</span> and <span class="Code" oldrole="parameter">value</span> parameters can include macros to create tables and columns dynamically (for details, see <xref linkend="reference-macros"></xref>).</p>
<table cellspacing="0" class="TableStyle-NoteTable_Yellow_DoNotEdit" oldrole="warning" style="width: 100%;mc-table-style: url('../../Resources/TableStyles/NoteTable_Yellow_DoNotEdit.css');"><col class="TableStyle-NoteTable_Yellow_DoNotEdit-Column-Column1" style="width: 0.3in;"></col><col class="TableStyle-NoteTable_Yellow_DoNotEdit-Column-Column2"></col><tbody><tr class="TableStyle-NoteTable_Yellow_DoNotEdit-Body-Body1"><td class="TableStyle-NoteTable_Yellow_DoNotEdit-BodyB-Column1-Body1"><p><img src="../../Resources/Images/Common/caution.png"/></p></td><td class="TableStyle-NoteTable_Yellow_DoNotEdit-BodyA-Column2-Body1"><span class="Yellow">Caution: </span><p oldrole="para">When using macros in table names, note that some databases limit the maximum allowed length of table names. Consult the documentation of the database for details.</p></td></tr></tbody></table>
<p oldrole="para">Inserting the records into the database is performed by a separate thread. The syslog-ng application automatically performs the escaping required to insert the messages into the database.</p>
<example xml:id="example-destination-sql">
<title>Using the sql() driver</title>
<indexterm>
<primary>destinations</primary>
<secondary>sql() configuration</secondary>
</indexterm>
<indexterm>
<primary>PostgreSQL</primary>
<secondary>sql() configuration</secondary>
</indexterm>
<p oldrole="para">The following example sends the log messages into a PostgreSQL database running on the <span class="Code" oldrole="userinput">logserver</span> host. The messages are inserted into the <span class="Code" oldrole="userinput">logs</span> database, the name of the table includes the exact date and the name of the host sending the messages. The syslog-ng application automatically creates the required tables and columns, if the user account used to connect to the database has the required privileges.</p>
<pre class="Code" oldrole="synopsis">destination d_sql {
    sql(type(pgsql)
    host("logserver") username("syslog-ng") password("password")
    database("logs")
    table("messages_${HOST}_${R_YEAR}${R_MONTH}${R_DAY}")
    columns("datetime", "host", "program", "pid", "message")
    values("{$R_DATE}", "${HOST}", "${PROGRAM}", "${PID}", "${MSGONLY}")
    indexes("datetime", "host", "program", "pid", "message"));
};</pre>
<p oldrole="para">The following example specifies the type of the database columns as well:</p>
<pre class="Code" oldrole="synopsis">destination d_sql {
    sql(type(pgsql)
    host("logserver") username("syslog-ng") password("password")
    database("logs")
    table("messages_${HOST}_${R_YEAR}${R_MONTH}${R_DAY}")
    columns("datetime varchar(16)", "host varchar(32)", "program  varchar(20)", "pid varchar(8)", "message  varchar(200)")
    values("${R_DATE}", "${HOST}", "${PROGRAM}", "${PID}", "${MSGONLY}")
    indexes("datetime", "host", "program", "pid", "message"));
};</pre>
</example>

<h2 name="configuring-sql-oracle">Using the sql() driver with an Oracle database</h2>
<indexterm>
<primary>Oracle</primary>
<secondary>sql() configuration</secondary>
</indexterm>
<p oldrole="para">The Oracle sql destination has some special aspects that are important to note.</p>
<ul oldrole="itemizedlist">
<li oldrole="listitem">
<p oldrole="para">The hostname of the database server is set in the <span class="Code" oldrole="filename">tnsnames.ora</span> file, not in the <span class="Code" oldrole="parameter">host</span> parameter of the <span class="Code" oldrole="parameter">sql()</span> destination.</p>
<p oldrole="para">If the <span class="Code" oldrole="filename">tnsnames.ora</span> file is not located in the /etc directory (or in the /var/opt/oracle directory on Solaris), set the following Oracle-related environment variables, so <entity>abbrev</entity> will find the file: <span class="Code" oldrole="parameter">ORACLE_BASE</span>, <span class="Code" oldrole="parameter">ORACLE_HOME</span>, and <span class="Code" oldrole="parameter">ORACLE_SID</span>. For details, see the documentation of the Oracle Instant Client.</p>
</li>
<li oldrole="listitem">
<p oldrole="para">You cannot use the same <span class="Code" oldrole="parameter">database()</span> settings in more than one destination, because the <span class="Code" oldrole="parameter">database()</span> option of the SQL driver is just a reference to the connection string of the <span class="Code" oldrole="filename">tnsnames.ora</span> file. To overcome this problem, you can duplicate the connections in the <span class="Code" oldrole="filename">tnsnames.ora</span> file under a different name, and use a different table in each Oracle destination in <entity>abbrev</entity>.</p>
</li>
<li oldrole="listitem">
<p oldrole="para">As certain database versions limit the maximum length of table names, macros in the table names should be used with care.</p>
</li>
<li oldrole="listitem">
<!-- FIXME delete when solved -->
<p oldrole="para">In the current version of <entity>abbrev</entity>, the types of database columns must be explicitly set for the Oracle destination. The column used to store the text part of the syslog messages should be able to store messages as long as the longest message permitted by syslog-ng, therefore it is usually recommended to use the <span class="Code" oldrole="userinput">varchar2</span> or <span class="Code" oldrole="userinput">clob</span> column type. (The maximum length of the messages can be set using the <span class="Code" oldrole="parameter">log-msg-size()</span> option.) For details, see the following example.</p>
</li>
<li oldrole="listitem">
<p oldrole="para">The Oracle Instant Client used by <entity>abbrev</entity> supports only the following character sets:</p>
<ul oldrole="itemizedlist">
<li oldrole="listitem">
<p oldrole="para">Single-byte character sets: <span class="Code" oldrole="userinput">US7ASCII, WE8DEC, WE8MSWIN1252, and WE8ISO8859P1</span></p>
</li>
<li oldrole="listitem">
<p oldrole="para">Unicode character sets: <span class="Code" oldrole="userinput">UTF8, AL16UTF16, and AL32UTF8</span></p>
</li>
</ul>
</li>
</ul>
<example xml:id="example-destination-sql-oracle">
<title>Using the sql() driver with an Oracle database</title>
<indexterm>
<primary>destinations</primary>
<secondary>sql() configuration</secondary>
</indexterm>
<indexterm>
<primary>Oracle</primary>
<secondary>sql() configuration</secondary>
</indexterm>
<p oldrole="para">The following example sends the log messages into an Oracle database running on the <span class="Code" oldrole="userinput">logserver</span> host, which must be set in the <span class="Code" oldrole="filename">/etc/tnsnames.ora</span> file. The messages are inserted into the <span class="Code" oldrole="userinput">LOGS</span> database, the name of the table includes the exact date when the messages were sent. The syslog-ng application automatically creates the required tables and columns, if the user account used to connect to the database has the required privileges.</p>
<pre class="Code" oldrole="synopsis">destination d_sql {
  sql(type(oracle)
  username("syslog-ng") password("password")
  database("LOGS")
  table("msgs_${R_YEAR}${R_MONTH}${R_DAY}")
  columns("datetime varchar(16)", "host varchar(32)", "program varchar(32)", "pid varchar(8)", "message varchar2")
  values("${R_DATE}", "${HOST}", "${PROGRAM}", "${PID}", "${MSGONLY}")
  indexes("datetime", "host", "program", "pid", "message"));
};</pre>
<p oldrole="para">The Oracle Instant Client retrieves the address of the database server from the <span class="Code" oldrole="filename">/etc/tnsnames.ora</span> file. Edit or create this file as needed for your configuration. A sample is provided below.</p>
<pre class="Code" oldrole="synopsis">LOGS =
(DESCRIPTION =
(ADDRESS_LIST =
(ADDRESS = (PROTOCOL = TCP)
(HOST = logserver)
(PORT = 1521))
)
(CONNECT_DATA =
(SERVICE_NAME = EXAMPLE.SERVICE)
)
)</pre>
</example>


<h2 name="configuring-sql-mssql">Using the sql() driver with a Microsoft SQL database</h2>
<indexterm>
<primary>Microsoft SQL</primary>
<secondary>sql() configuration</secondary>
</indexterm>
<indexterm>
<primary>MSSQL</primary>
<secondary>sql() configuration</secondary>
</indexterm>
<p oldrole="para">The <span class="Code" oldrole="parameter">mssql</span> database driver can access Microsoft SQL (MSSQL) destinations. This driver has some special aspects that are important to note.</p>
<ul oldrole="itemizedlist">
<li oldrole="listitem">
<p oldrole="para">The date format used by the MSSQL database must be explicitly set in the <span class="Code" oldrole="filename">/etc/locales.conf</span> file of the syslog-ng server. For details, see the following example.</p>
</li>
<li oldrole="listitem">
<p oldrole="para">As certain database versions limit the maximum length of table names, macros in the table names should be used with care.</p>
</li>
<li oldrole="listitem">
<p oldrole="para">In the current version of <entity>abbrev</entity>, the types of database columns must be explicitly set for the MSSQL destination.</p>
<MadCap:snippetBlock src="../../shared/wnt/warning-destination-mssql-columntypes.htm"></MadCap:snippetBlock>
</li>
<li oldrole="listitem">
<p oldrole="para">The column used to store the text part of the syslog messages should be able to store messages as long as the longest message permitted by syslog-ng. The <span class="Code" oldrole="parameter">varchar</span> column type can store maximum 4096 bytes-long messages. The maximum length of the messages can be set using the <span class="Code" oldrole="parameter">log-msg-size()</span> option. For details, see the following example.</p>
</li>
<li oldrole="listitem">
<p oldrole="para">Remote access for SQL users must be explicitly enabled on the Microsoft Windows host running the Microsoft SQL Server. For details, see <xref linkend="configure-mssql-server"></xref>.</p>
</li>
</ul>
<example xml:id="example-destination-sql-mssql">
<title>Using the sql() driver with an MSSQL database</title>
<indexterm>
<primary>destinations</primary>
<secondary>sql() configuration</secondary>
</indexterm>
<indexterm>
<primary>MSSQL</primary>
<secondary>sql() configuration</secondary>
</indexterm>
<p oldrole="para">The following example sends the log messages into an MSSQL database running on the <span class="Code" oldrole="userinput">logserver</span> host. The messages are inserted into the <span class="Code" oldrole="userinput">syslogng</span> database, the name of the table includes the exact date when the messages were sent. The syslog-ng application automatically creates the required tables and columns, if the user account used to connect to the database has the required privileges.</p>
<pre class="Code" oldrole="synopsis">destination d_mssql {
sql(type(mssql) host("logserver") port("1433")
  username("syslogng") password("syslogng") database("syslogng")
  table("msgs_${R_YEAR}${R_MONTH}${R_DAY}")columns("datetime varchar(16)", "host varchar(32)",
  "program varchar(32)", "pid varchar(8)", "message varchar(4096)")
  values("${R_DATE}", "${HOST}", "${PROGRAM}", "${PID}", "${MSGONLY}")
  indexes("datetime", "host", "program", "pid"));
};</pre>
<p oldrole="para">The date format used by the MSSQL database must be explicitly set in the <span class="Code" oldrole="filename">/etc/locales.conf</span> file of the syslog-ng server. Edit or create this file as needed for your configuration. A sample is provided below.</p>
<pre class="Code" oldrole="synopsis">[default]
date = "%Y-%m-%d %H:%M:%S"</pre>
</example>


<h2 name="sql-interactions-syslog-ng">The way syslog-ng interacts with the database</h2>

<p><b oldrole="formalpara">Used SQL operations by syslog-ng</b></p>
<p oldrole="para"></p>

<p oldrole="para"><i oldrole="emphasis">Create table:</i></p>
<ul oldrole="itemizedlist">
<li oldrole="listitem">
<p oldrole="para">If the given table does not exist, syslog-ng tries to create it with the given column types.</p>
</li>
<li oldrole="listitem">
<p oldrole="para">The <entity>abbrev</entity> application automatically creates the required tables and columns, if the user account used to connect to the database has the required privileges.</p>
</li>
<li oldrole="listitem">
<p oldrole="para">If syslog-ng cannot create or alter a table, it tries to do it again when it reaches the next <span class="Code" oldrole="parameter">time-reopen()</span>.</p>
</li>
</ul>
<p oldrole="para"><i oldrole="emphasis">Alter table:</i></p>
<ul oldrole="itemizedlist">
<li oldrole="listitem">
<p oldrole="para">If the table structure is different from given structure in an existing table, syslog-ng tries to add columns in this table but never will delete or modify an existing column.</p>
</li>
<li oldrole="listitem">
<p oldrole="para">If <entity>abbrev</entity> cannot create or alter a table, it tries to do it again when reach the next <span class="Code" oldrole="parameter">time-reopen()</span>.</p>
</li>
<li oldrole="listitem">
<p oldrole="para">The <entity>abbrev</entity> application requires read and write access to the SQL table, otherwise it cannot verify that the destination table exists.</p>
</li>
</ul>
<p oldrole="para"><i oldrole="emphasis">Insert table:</i></p>
<ul oldrole="itemizedlist">
<li oldrole="listitem">
<p oldrole="para">Insert new records in a table.</p>
</li>
<li oldrole="listitem">
<p oldrole="para">Inserting the records into the database is performed by a separate thread.</p>
</li>
<li oldrole="listitem">
<p oldrole="para">The <entity>abbrev</entity> application automatically performs the escaping required to insert the messages into the database.</p>
</li>
<li oldrole="listitem">
<p oldrole="para">If insert returns with error, syslog-ng tries to insert the message +two times by default, then drops it. Retrying time is the value of <span class="Code" oldrole="parameter">time-reopen()</span>.</p>
</li>
</ul>

<p><b oldrole="formalpara">Encoding</b></p>
<p oldrole="para"></p>

<p oldrole="para">The <entity>abbrev</entity> application uses UTF-8 by default when writes logs into database.</p>

<p><b oldrole="formalpara">Start/stop and reload</b></p>
<p oldrole="para"></p>

<p oldrole="para"><i oldrole="emphasis">Start:</i></p>
<ul oldrole="itemizedlist">
<li oldrole="listitem">
<p oldrole="para">The <entity>abbrev</entity> application will connect to database automatically after starting regardless existing incoming messages.</p>
</li>
</ul>
<p oldrole="para"><i oldrole="emphasis">Stop:</i></p>
<ul oldrole="itemizedlist">
<li oldrole="listitem">
<p oldrole="para">The <entity>abbrev</entity> application will close the connection to database before shutting down.</p>
</li>
</ul>
<p oldrole="para"><i oldrole="emphasis">Possibility of losing logs:</i></p>
<ul oldrole="itemizedlist">
<li oldrole="listitem">
<p oldrole="para">The <entity>abbrev</entity> application cannot lose logs during shutting down if disk buffer was given and it is not full yet.</p>
</li>
<li oldrole="listitem">
<p oldrole="para">The <entity>abbrev</entity> application cannot lose logs during shutting down if disk buffer was not given.</p>
</li>
</ul>
<p oldrole="para"><i oldrole="emphasis">Reload:</i></p>
<ul oldrole="itemizedlist">
<li oldrole="listitem">
<p oldrole="para">The <entity>abbrev</entity> application will close the connection to database if it received SIGHUP signal (reload).</p>
</li>
<li oldrole="listitem">
<p oldrole="para">It will reconnect to the database when it tries to send a new message to this database again.</p>
</li>
</ul>

<p><b oldrole="formalpara">Macros:</b></p>
<p oldrole="para"></p>

<p oldrole="para">The value of ${SEQNUM} macro will be overrided by sql driver regardless of local or relayed incoming message.</p>
<p oldrole="para">It will be grown continously.</p>

<h2>MySQL-specific interaction methods</h2>
<p oldrole="para">To specify the socket to use, set and export the <span class="Code" oldrole="parameter">MYSQL_UNIX_PORT</span> environment variable, for example <span class="Code" oldrole="userinput">MYSQL_UNIX_PORT=/var/lib/mysql/mysql.sock; export MYSQL_UNIX_PORT</span>.</p>


<h2>MsSQL-specific interaction methods</h2>
<p oldrole="para">In SQL Server 2005 this restriction is lifted - kind of. The total length of all key columns in an index cannot exceed 900 bytes.</p>
<p oldrole="para">If you are using <span class="Code" oldrole="parameter">null()</span> in your configuration, be sure that the columns allow <span class="Code" oldrole="parameter">NULL</span> to insert. Give the column as the following example: <span class="Code" oldrole="userinput">"datetime varchar(16) NULL"</span>.</p>
<p oldrole="para">The date format used by the MSSQL database must be explicitly set in the <span class="Code" oldrole="filename">/etc/locales.conf</span> file of the syslog-ng server. <span class="Code" oldrole="userinput">[default] date = "%Y-%m-%d %H:%M:%S"</span>.</p>



<h2 name="reference-destination-sql">sql() destination options</h2>
<indexterm>
<primary>destination drivers</primary>
<secondary><span class="Code" oldrole="parameter">sql()</span> driver</secondary>
</indexterm>
<indexterm>
<primary>destination drivers</primary>
<secondary>database driver</secondary>
</indexterm>
<p oldrole="para">This driver sends messages into an SQL database. The <span class="Code" oldrole="parameter">sql()</span> destination has the following options:</p>
<simplesect xml:id="sql-option-columns">
<title>columns()</title>
<indexterm type="parameter">
<primary>columns()</primary>
</indexterm>
<informaltable colsep="0" frame="topbot" rowsep="0">
<tgroup cols="2">
<colspec colnum="1" colwidth="40pt"></colspec>
<tbody>
<row>
<entry>Type: 
                                 </entry>
<entry>string list</entry>
</row>
<row>
<entry>Default: 
                                 </entry>
<entry>"date", "facility", "level", "host", "program", "pid", "message"</entry>
</row>
</tbody>
</tgroup>
</informaltable>
<p oldrole="para"><i oldrole="emphasis" role="bold">Description:</i> Name of the columns storing the data in <span class="Code" oldrole="userinput">fieldname [dbtype]</span> format. The <span class="Code" oldrole="userinput">[dbtype]</span> parameter is optional, and specifies the type of the field. By default, <entity>abbrev</entity> creates <span class="Code" oldrole="userinput">text</span> columns. Note that not every database engine can index text fields.</p>
<MadCap:snippetBlock src="../../shared/wnt/warning-destination-mssql-columntypes.htm"></MadCap:snippetBlock>
</simplesect>
<simplesect condition="ose" xml:id="sql-option-create-statement-append">
<title>create-statement-append()</title>
<indexterm type="parameter">
<primary>create-statement-append()</primary>
</indexterm>
<informaltable colsep="0" frame="topbot" rowsep="0">
<tgroup cols="2">
<colspec colnum="1" colwidth="40pt"></colspec>
<tbody>
<row>
<entry>Type: 
                                 </entry>
<entry>string</entry>
</row>
<row>
<entry>Default: 
                                 </entry>
<entry>empty string</entry>
</row>
</tbody>
</tgroup>
</informaltable>
<p oldrole="para"><i oldrole="emphasis" role="bold">Description:</i> Specifies additional SQL options that are appended to the CREATE statement. That way you can customize what happens when <entity>abbrev</entity> creates a new table in the database. Consult the documentation of your database server for details on the available options. Syntax:</p>
<pre class="Code" oldrole="synopsis">create-statement-append(&lt;options-to-append&gt;)</pre>
<p oldrole="para">For example, you can appends the <span class="Code" oldrole="userinput">ROW_FORMAT=COMPRESSED</span> option to MySQL create table statements:</p>
<pre class="Code" oldrole="synopsis">create-statement-append(ROW_FORMAT=COMPRESSED)</pre>
</simplesect>
<simplesect xml:id="sql-option-database">
<MadCap:snippetBlock src="../../shared/chunk/option-sql-database.htm"></MadCap:snippetBlock>
</simplesect>
<simplesect xml:id="sql-option-dbd-option">
<title>dbd-option()</title>
<indexterm type="parameter">
<primary>dbd-option()</primary>
</indexterm>
<informaltable colsep="0" frame="topbot" rowsep="0">
<tgroup cols="2">
<colspec colnum="1" colwidth="40pt"></colspec>
<tbody>
<row>
<entry>Type: 
                                 </entry>
<entry>string</entry>
</row>
<row>
<entry>Default: 
                                 </entry>
<entry>empty string</entry>
</row>
</tbody>
</tgroup>
</informaltable>
<p oldrole="para"><i oldrole="emphasis" role="bold">Description:</i> Specify database options that are set whenever <entity>abbrev</entity> connects to the database server. Consult the documentation of your database server for details on the available options. Syntax:</p>
<pre class="Code" oldrole="synopsis">dbd-option(OPTION_NAME VALUE)</pre>
<p oldrole="para">OPTION_NAME is always a string, VALUE is a string or a number. For example:</p>
<pre class="Code" oldrole="synopsis">dbd-option("null.sleep.connect" 1)
dbd-option("null.sleep.query" 5)</pre>
</simplesect>
<simplesect>
<MadCap:snippetBlock src="../../shared/chunk/option-destination-diskbuffer.htm"></MadCap:snippetBlock>
</simplesect>
<simplesect xml:id="sql-option-flags">
<title>flags()</title>
<indexterm type="parameter">
<primary>flags()</primary>
<secondary>for SQL destinations</secondary>
</indexterm>
<informaltable colsep="0" frame="topbot" rowsep="0">
<tgroup cols="2">
<colspec colnum="1" colwidth="40pt"></colspec>
<tbody>
<row>
<entry>Type: 
                                 </entry>
<entry>list of flags</entry>
</row>
<row>
<entry>Default: 
                                 </entry>
<entry>empty string</entry>
</row>
</tbody>
</tgroup>
</informaltable>
<p oldrole="para"><i oldrole="emphasis" role="bold">Description:</i> Flags related to the <span class="Code" oldrole="parameter">sql()</span> destination.</p>
<ul oldrole="itemizedlist">
<li oldrole="listitem">
<p oldrole="para"><i oldrole="emphasis">dont-create-tables</i>: Enable this flag to prevent <entity>abbrev</entity> from creating non-existing database tables automatically. The <entity>abbrev</entity> application typically has to create tables if you use macros in the table names. Available in <entity>abbrev</entity> version <phrase condition="ose">3.2</phrase><phrase condition="pe">4.0</phrase> and later.</p>
<indexterm type="parameter">
<primary>dont-create-tables</primary>
</indexterm>
</li>
<li oldrole="listitem">
<p oldrole="para"><i oldrole="emphasis">explicit-commits</i>: By default, <entity>abbrev</entity> commits every log message to the target database individually. When the <span class="Code" oldrole="parameter">explicit-commits</span> option is enabled, messages are committed in batches. This improves the performance, but results in some latency, as the messages are not immediately sent to the database. The size and frequency of batched commits can be set using the <span class="Code" oldrole="parameter">flush-lines()</span> and <span class="Code" oldrole="parameter">flush-timeout()</span> parameters. The <span class="Code" oldrole="parameter">explicit-commits</span> option is available in <entity>abbrev</entity> version <phrase condition="ose">3.2</phrase><phrase condition="pe">4.0</phrase> and later.</p>
<indexterm type="parameter">
<primary>explicit-commits</primary>
</indexterm>
</li>
</ul>
<example>
<title>Setting flags for SQL destinations</title>
<p oldrole="para">The following example sets the <span class="Code" oldrole="parameter">dont-create-tables</span> and <span class="Code" oldrole="parameter">explicit-commits</span> flags for an <span class="Code" oldrole="parameter">sql()</span> destination.</p>
<pre class="Code" oldrole="synopsis">flags(dont-create-tables,explicit-commits)</pre>
</example>
</simplesect>
<simplesect>
<MadCap:snippetBlock src="../../shared/chunk/option-destination-flush-lines.htm"></MadCap:snippetBlock>
</simplesect>
<simplesect>
<MadCap:snippetBlock src="../../shared/chunk/option-destination-flush-timeout.htm"></MadCap:snippetBlock>
</simplesect>
<simplesect>
<MadCap:snippetBlock src="../../shared/chunk/option-destination-frac-digits.htm"></MadCap:snippetBlock>
</simplesect>
<simplesect xml:id="sql-option-host">
<MadCap:snippetBlock src="../../shared/chunk/option-sql-host.htm"></MadCap:snippetBlock>
</simplesect>
<simplesect xml:id="sql-option-indexes">
<title>indexes()</title>
<indexterm type="parameter">
<primary>indexes()</primary>
</indexterm>
<informaltable colsep="0" frame="topbot" rowsep="0">
<tgroup cols="2">
<colspec colnum="1" colwidth="40pt"></colspec>
<tbody>
<row>
<entry>Type: 
                                 </entry>
<entry>string list</entry>
</row>
<row>
<entry>Default: 
                                 </entry>
<entry>"date", "facility", "host", "program"</entry>
</row>
</tbody>
</tgroup>
</informaltable>
<p oldrole="para"><i oldrole="emphasis" role="bold">Description:</i> The list of columns that are indexed by the database to speed up searching. To disable indexing for the destination, include the empty <span class="Code" oldrole="parameter">indexes()</span> parameter in the destination, simply omitting the <span class="Code" oldrole="parameter">indexes</span> parameter will cause syslog-ng to request indexing on the default columns.</p>
<p oldrole="para">The <entity>abbrev</entity> application will create the name of indexes automaticaly with the following method:</p>
<ul oldrole="itemizedlist">
<li oldrole="listitem">
<p oldrole="para">In case of MsSQL, PostgreSQL, MySQL or SQLite or (Oracle but tablename &lt; 30 characters): <span class="Code" oldrole="userinput">{table}_{column}_idx</span>.</p>
</li>
<li oldrole="listitem">
<p oldrole="para">In case of Oracle and tablename &gt; 30 characters: <span class="Code" oldrole="userinput">md5sum of {table}_{column}-1</span> and the first character will be replaced by "i" character and the md5sum will be truncated to 30 characters.</p>
</li>
</ul>
</simplesect>
<simplesect>
<MadCap:snippetBlock src="../../shared/chunk/option-destination-local-timezone.htm"></MadCap:snippetBlock>
</simplesect>
<simplesect>
<MadCap:snippetBlock src="../../shared/chunk/option-destination-log-fifo-size.htm"></MadCap:snippetBlock>
</simplesect>
<simplesect xml:id="sql-option-null">
<title>null()</title>
<indexterm type="parameter">
<primary>null()</primary>
</indexterm>
<informaltable colsep="0" frame="topbot" rowsep="0">
<tgroup cols="2">
<colspec colnum="1" colwidth="40pt"></colspec>
<tbody>
<row>
<entry>Type: 
                                 </entry>
<entry>string</entry>
</row>
<row>
<entry>Default: 
                                 </entry>
<entry></entry>
</row>
</tbody>
</tgroup>
</informaltable>
<p oldrole="para"><i oldrole="emphasis" role="bold">Description:</i> If the content of a column matches the string specified in the <span class="Code" oldrole="parameter">null()</span> parameter, the contents of the column will be replaced with an SQL NULL value. If unset (by default), the option does not match on any string. For details, see the <xref linkend="example-destination-sql-null"></xref>.</p>
<example xml:id="example-destination-sql-null">
<title>Using SQL NULL values</title>
<indexterm>
<primary>destinations</primary>
<secondary>sql() configuration</secondary>
</indexterm>
<indexterm>
<primary>SQL NULL values</primary>
</indexterm>
<p oldrole="para">The <span class="Code" oldrole="parameter">null()</span> parameter of the SQL driver can be used to replace the contents of a column with a special SQL NULL value. To replace every column that contains an empty string with NULL, use the <span class="Code" oldrole="userinput">null("")</span> option, for example</p>
<pre class="Code" oldrole="synopsis">destination d_sql {
    sql(type(pgsql)
    host("logserver") username("syslog-ng") password("password")
    database("logs")
    table("messages_${HOST}_${R_YEAR}${R_MONTH}${R_DAY}")
    columns("datetime", "host", "program", "pid", "message")
    values("${R_DATE}", "${HOST}", "${PROGRAM}", "${PID}", "${MSGONLY}")
    indexes("datetime", "host", "program", "pid", "message")
    null(""));
};</pre>
<p oldrole="para">To replace only a specific column (for example <span class="Code" oldrole="parameter">pid</span>) if it is empty, assign a default value to the column, and use this default value in the <span class="Code" oldrole="parameter">null()</span> parameter:</p>
<pre class="Code" oldrole="synopsis">destination d_sql {
    sql(type(pgsql)
    host("logserver") username("syslog-ng") password("password")
    database("logs")
    table("messages_${HOST}_${R_YEAR}${R_MONTH}${R_DAY}")
    columns("datetime", "host", "program", "pid", "message")
    values("${R_DATE}", "${HOST}", "${PROGRAM}", "${PID:-@@NULL@@}", "${MSGONLY}")
    indexes("datetime", "host", "program", "pid", "message")
    null("@@NULL@@"));
};</pre>
<p oldrole="para">Ensure that the default value you use does not appear in the actual log messages, because other occurrences of this string will be replaced with NULL as well.</p>
</example>
</simplesect>
<simplesect xml:id="sql-option-password">
<MadCap:snippetBlock src="../../shared/chunk/option-sql-password.htm"></MadCap:snippetBlock>
</simplesect>
<simplesect xml:id="sql-option-port">
<MadCap:snippetBlock src="../../shared/chunk/option-sql-port.htm"></MadCap:snippetBlock>
</simplesect>
<simplesect xml:id="sql-option-retry-sql-inserts">
<title>retries()</title>
<indexterm type="parameter">
<primary>retry_sql_inserts</primary>
<!-- This is an alias used in older documentation releases -->
</indexterm>
<indexterm type="parameter">
<primary>retries()</primary>
</indexterm>
<informaltable colsep="0" frame="topbot" rowsep="0">
<tgroup cols="2">
<colspec colnum="1" colwidth="40pt"></colspec>
<tbody>
<row>
<entry>Type: 
                                 </entry>
<entry>number (insertion attempts)</entry>
</row>
<row>
<entry>Default: 
                                 </entry>
<entry>3</entry>
</row>
</tbody>
</tgroup>
</informaltable>
<p oldrole="para"><i oldrole="emphasis" role="bold">Description:</i> The number of insertion attempts. If <entity>abbrev</entity> could not insert a message into the database, it will repeat the attempt until the number of attempts reaches <span class="Code" oldrole="parameter">retries</span>, then drops the connection to the database. For example, <entity>abbrev</entity> will try to insert a message maximum three times by default (once for first insertion and twice if the first insertion was failed).</p>
</simplesect>
<simplesect xml:id="sql-option-session-statements">
<title>session-statements()</title>
<indexterm type="parameter">
<primary>session-statements()</primary>
</indexterm>
<indexterm>
<primary>session_statements()</primary>
</indexterm>
<informaltable colsep="0" frame="topbot" rowsep="0">
<tgroup cols="2">
<colspec colnum="1" colwidth="40pt"></colspec>
<tbody>
<row>
<entry>Type: 
                                 </entry>
<entry>comma-separated list of SQL statements</entry>
</row>
<row>
<entry>Default: 
                                 </entry>
<entry>empty string</entry>
</row>
</tbody>
</tgroup>
</informaltable>
<p oldrole="para"><i oldrole="emphasis" role="bold">Description:</i> Specifies one or more SQL-like statement which is executed after <entity>abbrev</entity> has successfully connected to the database. For example:</p>
<pre class="Code" oldrole="synopsis">session-statements("SET COLLATION_CONNECTION='utf8_general_ci'")</pre>
<table cellspacing="0" class="TableStyle-NoteTable_Yellow_DoNotEdit" oldrole="warning" style="width: 100%;mc-table-style: url('../../Resources/TableStyles/NoteTable_Yellow_DoNotEdit.css');"><col class="TableStyle-NoteTable_Yellow_DoNotEdit-Column-Column1" style="width: 0.3in;"></col><col class="TableStyle-NoteTable_Yellow_DoNotEdit-Column-Column2"></col><tbody><tr class="TableStyle-NoteTable_Yellow_DoNotEdit-Body-Body1"><td class="TableStyle-NoteTable_Yellow_DoNotEdit-BodyB-Column1-Body1"><p><img src="../../Resources/Images/Common/caution.png"/></p></td><td class="TableStyle-NoteTable_Yellow_DoNotEdit-BodyA-Column2-Body1"><span class="Yellow">Caution: </span><p oldrole="para">The <entity>abbrev</entity> application does not validate or limit the contents of customized queries. Consequently, queries performed with a user with write-access can potentially modify or even harm the database. Use customized queries with care, and only for your own responsibility.</p></td></tr></tbody></table>
</simplesect>
<simplesect xml:id="sql-option-table">
<title>table()</title>
<indexterm type="parameter">
<primary>table()</primary>
</indexterm>
<informaltable colsep="0" frame="topbot" rowsep="0">
<tgroup cols="2">
<colspec colnum="1" colwidth="40pt"></colspec>
<tbody>
<row>
<entry>Type: 
                                 </entry>
<entry>string</entry>
</row>
<row>
<entry>Default: 
                                 </entry>
<entry>messages</entry>
</row>
</tbody>
</tgroup>
</informaltable>
<p oldrole="para"><i oldrole="emphasis" role="bold">Description:</i> Name of the database table to use (can include macros). When using macros, note that some databases limit the length of table names.</p>
</simplesect>
<simplesect>
<MadCap:snippetBlock src="../../shared/chunk/option-destination-timezone.htm"></MadCap:snippetBlock>
</simplesect>
<simplesect xml:id="sql-option-type">
<title>type()</title>
<indexterm type="parameter">
<primary>type()</primary>
</indexterm>
<informaltable colsep="0" frame="topbot" rowsep="0">
<tgroup cols="2">
<colspec colnum="1" colwidth="40pt"></colspec>
<tbody>
<row>
<entry>Type: 
                                 </entry>
<entry>mssql, mysql, oracle, pgsql, or sqlite3</entry>
</row>
<row>
<entry>Default: 
                                 </entry>
<entry>mysql</entry>
</row>
</tbody>
</tgroup>
</informaltable>
<MadCap:snippetBlock src="../../shared/chunk/option-description-sql-type.htm"></MadCap:snippetBlock>
</simplesect>
<simplesect>
<MadCap:snippetBlock src="../../shared/chunk/option-sql-username.htm"></MadCap:snippetBlock>
</simplesect>
<simplesect xml:id="sql-option-values">
<title>values()</title>
<indexterm type="parameter">
<primary>values()</primary>
</indexterm>
<informaltable colsep="0" frame="topbot" rowsep="0">
<tgroup cols="2">
<colspec colnum="1" colwidth="40pt"></colspec>
<tbody>
<row>
<entry>Type: 
                                 </entry>
<entry>string list</entry>
</row>
<row>
<entry>Default: 
                                 </entry>
<entry>"${R_YEAR}-${R_MONTH}-${R_DAY}, ${R_HOUR}:${R_MIN}:${R_SEC}", "${FACILITY}", "${LEVEL}", "${HOST}", "${PROGRAM}", "${PID}", "${MSGONLY}"</entry>
</row>
</tbody>
</tgroup>
</informaltable>
<p oldrole="para"><i oldrole="emphasis" role="bold">Description:</i> The parts of the message to store in the fields specified in the <span class="Code" oldrole="parameter">columns()</span> parameter.</p>
<p oldrole="para">It is possible to give a special value calling: default (without quotation marks).It means that the value will be used that is the default of the column type of this value.</p>
<example>
<title>Value: default</title>
<pre class="Code" oldrole="synopsis">columns("date datetime", "host varchar(32)", "row_id serial")
    values("${R_DATE}", "${HOST}", default)</pre>
</example>
</simplesect>

</body></html>
