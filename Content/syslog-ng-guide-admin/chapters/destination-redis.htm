<?xml version="1.0" encoding="UTF-8"?>
%entities;]&gt;
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
 <body condition="ose" name="configuring-destinations-redis" oldrole="section">
  <h1 condition="ose" name="configuring-destinations-redis" oldrole="section">
   <span class="Code" oldrole="parameter">
    redis
   </span>
   : Storing name-value pairs in Redis
  </h1>
  <MadCap:keyword term="destination drivers:[&lt;span class=&quot;Code&quot; oldrole=&quot;parameter&quot;&gt;redis()&lt;/span&gt;, ' driver']">
  </MadCap:keyword>
  <p oldrole="para">
   The
   <span class="Code" oldrole="parameter">
    redis()
   </span>
   driver sends messages as name-value pairs to a
   <a href="https://redis.io/">
    Redis
   </a>
   key-value store.
  </p>
  <p oldrole="para">
   For the list of available parameters, see
   <xref linkend="reference-destination-redis">
   </xref>
   .
  </p>
  <p>
   <b oldrole="formalpara">
    Declaration:
   </b>
  </p>
  <p oldrole="para">
  </p>
  <p class="Code" oldrole="synopsis">
   redis(
    host("&lt;redis-server-address&gt;")
    port("&lt;redis-server-port&gt;")
    auth("&lt;redis-server-password&gt;") # Optional, for password-protected servers
    command("&lt;redis-command&gt;", "&lt;first-command-parameter&gt;", "&lt;second-command-parameter&gt;", "&lt;third-command-parameter&gt;")
);
  </p>
  <example xml:id="example-using-redis">
   <title>
    Using the redis() driver
   </title>
   <p oldrole="para">
    The following destination counts the number of log messages received per host.
   </p>
   <p class="Code" oldrole="synopsis">
    destination d_redis {
    redis(
        host("localhost")
        port(6379)
        command("HINCRBY", "hosts", "$HOST", "1")
    );
};
   </p>
   <p oldrole="para">
    The following example creates a statistic from Apache webserver logs about the browsers that the visitors use (per minute)
   </p>
   <p class="Code" oldrole="synopsis">
    @version:
    <entity>
     techversion
    </entity>
    source s_apache {
    file("/var/log/apache2/access.log");
};

parser p_apache {
    csv-parser(columns("APACHE.CLIENT_IP", "APACHE.IDENT_NAME", "APACHE.USER_NAME",
                    "APACHE.TIMESTAMP", "APACHE.REQUEST_URL", "APACHE.REQUEST_STATUS",
                    "APACHE.CONTENT_LENGTH", "APACHE.REFERER", "APACHE.USER_AGENT",
                    "APACHE.PROCESS_TIME", "APACHE.SERVER_NAME")
                flags(escape-double-char,strip-whitespace)
    delimiters(" ")
    quote-pairs('""[]')
    );
};

destination d_redis {
    redis( command("HINCRBY" "${MONTH_ABBREV} ${DAY} ${HOUR}:${MIN}"  "${APACHE.USER_AGENT}" "1"));
};

log {
    source(s_apache);
    parser(p_apache);
    destination(d_redis);
};
   </p>
  </example>
  <h2 name="reference-destination-redis">
   redis() destination options
  </h2>
  <indexterm>
   <primary>
    destination drivers
   </primary>
   <secondary>
    <span class="Code" oldrole="parameter">
     redis()
    </span>
    driver
   </secondary>
  </indexterm>
  <p oldrole="para">
   The
   <span class="Code" oldrole="parameter">
    redis()
   </span>
   driver sends messages as name-value pairs to a
   <a href="https://redis.io/">
    Redis
   </a>
   key-value store.
  </p>
  <p oldrole="para">
   The
   <span class="Code" oldrole="parameter">
    redis()
   </span>
   destination has the following options:
  </p>
  <simplesect xml:id="redis-option-auth">
   <title>
    auth()
   </title>
   <indexterm type="parameter">
    <primary>
     auth()
    </primary>
   </indexterm>
   <informaltable colsep="0" frame="topbot" rowsep="0">
    <tgroup cols="2">
     <colspec colnum="1" colwidth="40pt">
     </colspec>
     <tbody>
      <row>
       <entry>
        Type:
       </entry>
       <entry>
        hostname or IP address
       </entry>
      </row>
      <row>
       <entry>
        Default:
       </entry>
       <entry>
        N/A
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
   <p oldrole="para">
    <i oldrole="emphasis" role="bold">
     Description:
    </i>
    The password used for authentication on a password-protected Redis server. Available in
    <entity>
     abbrev
    </entity>
    version
    <phrase condition="ose">
     3.10
    </phrase>
    and later.
   </p>
  </simplesect>
  <simplesect xml:id="redis-option-command">
   <title>
    command()
   </title>
   <indexterm type="parameter">
    <primary>
     command()
    </primary>
   </indexterm>
   <informaltable colsep="0" frame="topbot" rowsep="0">
    <tgroup cols="2">
     <colspec colnum="1" colwidth="40pt">
     </colspec>
     <tbody>
      <row>
       <entry>
        Type:
       </entry>
       <entry>
        comma-separated list of strings ("&lt;redis-command&gt;", "&lt;first-command-parameter&gt;", "&lt;second-command-parameter&gt;", "&lt;third-command-parameter&gt;")
       </entry>
      </row>
      <row>
       <entry>
        Default:
       </entry>
       <entry>
        empty string
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
   <p oldrole="para">
    <i oldrole="emphasis" role="bold">
     Description:
    </i>
    The
    <a href="https://redis.io/commands">
     Redis command
    </a>
    to execute, for example, LPUSH, INCR, or HINCRBY. Using the HINCRBY command with an increment value of 1 allows you to create various statistics. For example, the
    <span class="Code" oldrole="userinput">
     command("HINCRBY" "${HOST}/programs" "${PROGRAM}" "1")
    </span>
    command counts the number of log messages on each host for each program.
   </p>
   <p oldrole="para">
    Note the following points when using the
    <span class="Code" oldrole="userinput">
     redis()
    </span>
    destination:
   </p>
   <ul oldrole="itemizedlist">
    <li oldrole="listitem">
     <p oldrole="para">
      You can use macros and templates in the parameters of the Redis command.
     </p>
    </li>
    <li oldrole="listitem">
     <p oldrole="para">
      Currently you can use only one command in a redis() destination.
     </p>
    </li>
    <li oldrole="listitem">
     <p oldrole="para">
      The
      <entity>
       abbrev
      </entity>
      application ignores the return value of the command. If the Redis server returns an error,
      <entity>
       abbrev
      </entity>
      closes the connection.
     </p>
    </li>
   </ul>
  </simplesect>
  <simplesect>
   <MadCap:snippetBlock src="../../shared/chunk/option-destination-diskbuffer.htm">
   </MadCap:snippetBlock>
  </simplesect>
  <simplesect xml:id="redis-option-host">
   <title>
    host()
   </title>
   <indexterm type="parameter">
    <primary>
     host()
    </primary>
   </indexterm>
   <informaltable colsep="0" frame="topbot" rowsep="0">
    <tgroup cols="2">
     <colspec colnum="1" colwidth="40pt">
     </colspec>
     <tbody>
      <row>
       <entry>
        Type:
       </entry>
       <entry>
        hostname or IP address
       </entry>
      </row>
      <row>
       <entry>
        Default:
       </entry>
       <entry>
        127.0.0.1
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
   <p oldrole="para">
    <i oldrole="emphasis" role="bold">
     Description:
    </i>
    The hostname or IP address of the Redis server.
   </p>
  </simplesect>
  <simplesect xml:id="redis-option-port">
   <title>
    port()
   </title>
   <indexterm type="parameter">
    <primary>
     port()
    </primary>
   </indexterm>
   <informaltable colsep="0" frame="topbot" rowsep="0">
    <tgroup cols="2">
     <colspec colnum="1" colwidth="40pt">
     </colspec>
     <tbody>
      <row>
       <entry>
        Type:
       </entry>
       <entry>
        number
       </entry>
      </row>
      <row>
       <entry>
        Default:
       </entry>
       <entry>
        6379
       </entry>
      </row>
     </tbody>
    </tgroup>
   </informaltable>
   <p oldrole="para">
    <i oldrole="emphasis" role="bold">
     Description:
    </i>
    The port number of the Redis server.
   </p>
  </simplesect>
  <simplesect>
   <MadCap:snippetBlock src="../../shared/chunk/option-destination-retries.htm">
   </MadCap:snippetBlock>
  </simplesect>
  <simplesect>
   <MadCap:snippetBlock src="../../shared/chunk/option-destination-throttle.htm">
   </MadCap:snippetBlock>
  </simplesect>
 </body>
</html>
