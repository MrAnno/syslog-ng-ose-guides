<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter SYSTEM "../../xml-stylesheet/pdf/dtd/docbookx.dtd"
 [  <!ENTITY % entities SYSTEM "../syslog-ng-entities.ent">
 %entities;]> 
<chapter id=chapter-troubleshooting-syslog-ng>
    <title>Troubleshooting syslog-ng</title>
    <section id="concepts_losing_messages">
        <title>Possible causes of losing log messages</title>
        <indexterm>
            <primary>losing messages</primary>
        </indexterm>
        <indexterm>
            <primary>message loss</primary>
        </indexterm>
        <para>During the course of a message from the sending application to the final destination
            of the message, there are a number of locations where a message may be lost, even though
            syslog-ng does its best to avoid message loss. Usually losing messages can be avoided
            with careful planning and proper configuration of syslog-ng and the hosts running
            syslog-ng. The following list shows the possible locations where messages may be lost,
            and provides methods to minimize the risk of losing messages.</para>
        <note>
            <para>The following list covers the main possibilities of losing messages, but does not
                take into account the possible use of flow-control (see <xref
                    linkend="concepts_flow_control"/>). This topic will be addressed in more detail
                in the future releases of this guide.</para>
        </note>
        <itemizedlist>
            <listitem>
                <para><emphasis>Between the application and the syslog-ng client</emphasis>: Make
                    sure to use an appropriate source to receive the logs from the application
                    (for example from <filename>/dev/log</filename>). For example, use
                        <parameter>unix-stream</parameter> instead of
                    <parameter>unix-dgram</parameter> whenever possible. </para>
            </listitem>
            <listitem>
                <para><emphasis>When syslog-ng is sending messages</emphasis>: If syslog-ng cannot
                    send messages to the destination and the output buffer gets full, syslog-ng will
                    drop messages. The number of dropped messages is displayed per destination in
                    the log message statistics of syslog-ng (see <xref
                        linkend="reference_log_statistics"/> for details).</para>
            </listitem>
            <listitem>
                <para><emphasis>On the network</emphasis>: When transferring messages using the UDP
                    protocol, messages may be lost without any notice or feedback &mdash; such
                    is the nature of the UDP protocol. Always use the TCP protocol to transfer
                    messages over the network whenever possible.</para>
            </listitem>
            <listitem>
                <para><emphasis>In the socket receive buffer</emphasis>: When transferring messages
                    using the UDP protocol, the UDP datagram (i.e., the message) that reaches the
                    receiving host placed in a memory area called the <parameter>socket receive
                        buffer</parameter>. If the host receives more messages than it can process,
                    this area overflows, and the kernel drops messages without letting syslog-ng
                    know about it. Using TCP instead of UDP prevents this issue. If you must use the
                    UDP protocol, increase the size of the receive buffer using the
                        <parameter>so_rcvbuf()</parameter> option.</para>
            </listitem>
            <listitem>
                <para><emphasis>When syslog-ng is receiving messages</emphasis>: The receiving
                    syslog-ng (for example the syslog-ng server or relay) may drop messages if the fifo of
                    the destination file gets full. The number of dropped messages is displayed per
                    destination in the log message statistics of syslog-ng (see <xref
                        linkend="reference_log_statistics"/> for details).</para>
            </listitem>
            <listitem>
                <para><emphasis>When the destination cannot handle large load</emphasis>: When
                    syslog-ng is sending messages at a high rate into an SQL database, a file, or
                    another destination, it is possible that the destination cannot handle the load,
                    and processes the messages slowly. As a result, the buffers of syslog-ng fill
                    up, syslog-ng cannot process the incoming messages, and starts to loose
                    messages. See the previous entry for details. Use the
                    <parameter>throttle</parameter> parameter to avoid this problem.</para>
            </listitem>
            <listitem>
                <para><emphasis>As a result of an unclean shutdown of the syslog-ng
                    server</emphasis>: If the host running the syslog-ng server experiences an
                    unclean shutdown, it takes time until the clients realize that the connection to
                    the syslog-ng server is down. Messages that are put into the output TCP buffer
                    of the clients during this period are not sent to the server.</para>
            </listitem>
        </itemizedlist>
    </section>
</chapter>
