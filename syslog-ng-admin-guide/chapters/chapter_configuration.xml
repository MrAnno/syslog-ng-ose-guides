<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter SYSTEM "../../xml-stylesheet/pdf/dtd/docbookx.dtd"
 [  <!ENTITY % entities SYSTEM "../syslog-ng-entities.ent">
 %entities;]> 
<chapter id="chapter_configuration">
    <title>Configuring syslog-ng</title>
    <indexterm>
        <primary>configuring syslog-ng</primary>
        <secondary>on Linux/Unix</secondary>
    </indexterm>
    <para>This chapter describes how to configure syslog-ng. </para>
    <section id="config_file">
        <title>The syslog-ng configuration file</title>
        <indexterm significance="preferred">
            <primary>syslog-ng.conf</primary>
        </indexterm>
        <para>The syslog-ng application is configured by editing the
            <filename>syslog-ng.conf</filename> file. Use any regular text editor application to
            modify the file. The precompiled syslog-ng packages include sample configuration files
            as well.</para>
        <para>Every syslog-ng configuration file must begin with a line containing the version
            information of syslog-ng. For syslog-ng version &version;, this line looks like:</para>
        <synopsis>@version:&version;</synopsis>
        <para>Versioning the configuration file was introduced in syslog-ng 3.0. If the configuration file does not contain the version information, syslog-ng assumes
            that the file is for syslog-ng version 2.x. In this case it interprets the configuration
            and sends warnings about the parts of the configuration that should be updated. Version
            3.0 and later will correctly operate with configuration files of version 2.x, but the
            default values of certain parameters have changed since 3.0.</para>
        <para>All identifiers, option names and attributes, and any other strings used in the
            syslog-ng configuration file are case sensitive. Objects must be defined before they are
            referenced in another statement.</para>
        <example>
            <title>A simple configuration file</title>
            <para>The following is a very simple configuration file for syslog-ng: it collects the
                internal messages of syslog-ng and the messages from <parameter>/dev/log</parameter>
                into the <filename>/var/log/messages_syslog-ng.log</filename> file.</para>
            <synopsis>@version:3.0
                
source s_local { unix-stream("/dev/log"); internal(); };

destination d_file {file("/var/log/messages_syslog-ng.log"); };

log { source(s_local); destination(d_file); };</synopsis>
        </example>
        <tip>
            <para>Before activating a new configuration, check that your configuration file is
                syntactically correct using the <command>syslog-ng --syntax-only</command> command.</para>
            <para>To activate the configuration, reload the configuration of syslog-ng using the
                    <command>/etc/init.d/syslog-ng reload</command> command.</para>
        </tip>
        <para>The <filename>syslog-ng.conf</filename> file is
            located under the <filename>/opt/syslog-ng/etc/</filename> directory.</para>
        <note>
            <para>Earlier versions of &abbrev; stored the configuration file in
                different directories, depending on the platform; typically under
                    <filename>/etc/syslog-ng/</filename>.</para>
        </note>
        <!-- <table id="configfile_location">
            <title>The location of syslog-ng.conf on different platforms</title>
            
            <tgroup cols="2">
                <thead>
                    <row>
                        <entry>Operating System</entry>
                        <entry>Location</entry>
                    </row>
                </thead>
                <tbody>
                    <row>
                        <entry>Linux, AIX 5.x</entry>
                        <entry>
                            <filename>/etc/syslog-ng/syslog-ng.conf</filename>
                        </entry>
                    </row>
                    <row>
                        <entry>Solaris, HP-UX, FreeBSD</entry>
                        <entry>
                            <filename>/opt/syslog-ng/syslog-ng.conf</filename>
                        </entry>
                    </row>
                </tbody>
            </tgroup>
        </table>
        <note>
            <para>On HP-UX and Solaris operating systems the earlier versions of syslog-ng stored
                the configuration file at
                <filename>/opt/syslog-ng/etc/syslog-ng/syslog-ng.conf</filename>.</para>
        </note> -->        
        <section id="including-config-files">
            <title>Including configuration files</title>
            <indexterm>
                <primary>syslog-ng.conf</primary>
                <secondary>includes</secondary>
            </indexterm>
            <indexterm>
                <primary>configuration file</primary>
                <secondary>including other files</secondary>
            </indexterm>
            <para>The syslog-ng application supports including external files in its configuration
                file, so parts of its configuration can be managed separately. To include the
                contents of a file in the syslog-ng configuration, use the following syntax</para>
            <synopsis>include "filename";</synopsis>
            <para>This imports the entire file into the configuration of syslog-ng, at the location
                of the include statement. If you specify a directory, syslog-ng will try to include
                every file in alphabetic order. When including configuration files, consider the
                following points:</para>
            <itemizedlist>
                <listitem>
                    <para>If an object is defined twice (for example the original syslog-ng configuration
                        file and the file imported into this configuration file both define the same
                        option, source, or other object), then the object that is defined later in
                        the configuration file will be effective. For example, if you set a global
                        option at the beginning of the configuration file, and later include a file
                        that defines the same option with a different value, then the option defined
                        in the imported file will be used.</para>
                </listitem>
                <listitem>
                    <para>Files can be embedded into each other: the included files can contain
                        include statements as well, up to a maximum depth of 15 levels.</para>
                </listitem>
                <listitem>
                    <para>Include statements can only be used at top level of the configuration
                        file. For example, the following is correct:</para>
                    <synopsis>@version:3.0
include "example.conf";</synopsis>
                    <para>But the following is not:</para>
                    <synopsis>source s_example {
    include "example.conf"
     };</synopsis>
                </listitem>
            </itemizedlist>
            <warning>
                <para>The syslog-ng application will not start if it cannot find a file that is to
                    be included in its configuration. Always double-check the filenames, paths, and
                    access rights when including configuration files, and use the
                        <command>--syntax-only</command> command-line option to check your
                    configuration.</para>
            </warning>
        </section>
    </section>

    <section id="defining_global_objects">
        <title>Defining global objects</title>
        <indexterm>
            <primary>global objects</primary>
            <secondary>defining</secondary>
        </indexterm>
        <indexterm>
            <primary>defining global objects</primary>
        </indexterm>
        <para id="global_objects_para1">Global objects (for example sources, destinations, log paths, or
            filters) are defined in the syslog-ng configuration file. Object definitions consist of
            the following elements: </para>
        <itemizedlist id="global_objects_syntax">
            <listitem>
                <para><emphasis>Type of the object</emphasis>: One of <parameter>source</parameter>,
                        <parameter>destination</parameter>, <parameter>log</parameter>,
                        <parameter>filter</parameter>, <parameter>parser</parameter>,
                        <parameter>rewrite</parameter> rule, or
                <parameter>template</parameter>.</para>
            </listitem>
            <listitem>
                <para><emphasis>Identifier of the object</emphasis>: A unique name identifying the
                    object. When using a reserved word as an identifier, enclose the identifier in
                    quotation marks.</para>
                <tip>
                    <para>Use identifiers that refer to the type of the object they identify. For
                        example, prefix source objects with <parameter>s_</parameter>, destinations
                        with <parameter>d_</parameter>, and so on. </para>
                </tip>
            </listitem>
            <listitem>
                <para><emphasis>Parameters</emphasis>: The parameters of the object, enclosed in
                    braces <parameter>{parameters}</parameter>.</para>
            </listitem>
            <listitem>
                <para><emphasis>Semicolon</emphasis>: Object definitions end with a semicolon
                        (<parameter>;</parameter>).</para>
            </listitem>
        </itemizedlist>
        <para id="global_objects_para2">The syntax is summarized as follows:</para>
        <synopsis>type identifier { parameters };</synopsis>
        <para>Objects have parameters; some of them are required, others are optional. Required
            parameters are positional, meaning that they must be specified in a defined order.
            Optional arguments can be specified in any order using the
            <literal>option(value)</literal> format. If a parameter (optional or required) is not
            specified, its default value is used. The parameters and their default values are listed
            in the reference section of the particular object. See <xref linkend="chapter_reference"
            /> for details.</para>
        <example>
            <title>Using required and optional parameters</title>
            <para>The <parameter>unix-stream()</parameter> source driver has a single required
                argument: the name of the socket to listen on. Optional parameters follow the socket
                name in any order, so the following source definitions have the same effect: </para>
            <synopsis>source s_demo_stream1 { 
           unix-stream("/dev/log" max-connections(10) group(log)); };
source s_demo_stream2 { 
           unix-stream("/dev/log" group(log) max-connections(10)); };</synopsis>
        </example>
        <para>To add comments to the configuration file, start a line with <parameter>#</parameter>
            and write your comments. These lines are ignored by syslog-ng.</para>
        <synopsis># Comment: This is a stream source
source s_demo_stream { 
           unix-stream("/dev/log" max-connections(10) group(log)); };</synopsis>
        <section id="configfile_syntax">
            <title>Notes about the configuration syntax</title>
            <para>When you are editing the syslog-ng configuration file, note the following points:</para>
            <itemizedlist>
                <listitem>
                    <para>When writing the names of options and parameters (or other reserved
                        words), the hyphen (<parameter>-</parameter>) and underscore
                        (<parameter>_</parameter>) characters are equivalent, for example
                            <parameter>max-connections(10)</parameter> and
                            <parameter>max_connections(10)</parameter> are both correct.</para>
                </listitem>
                <listitem>
                    <para>Number can be prefixed with <parameter>+</parameter> or
                        <parameter>-</parameter> to indicate positive or negative values. Numbers
                        beginning with zero (<parameter>0</parameter>) or <parameter>0x</parameter>
                        are treated as octal or hexadecimal numbers, respectively.</para>
                </listitem>
                <listitem>
                    <para>You can use commas (<parameter>,</parameter>) to separate options or other
                        parameters for readability; syslog-ng completely ignores them. The following
                        declarations are equivalent:</para>
                    <synopsis>source s_demo_stream { 
                        unix-stream("/dev/log" max-connections(10) group(log)); };</synopsis>
                    <synopsis>source s_demo_stream { 
                        unix-stream("/dev/log", max-connections(10), group(log)); };</synopsis>
                </listitem>
                <listitem>
                    <para>Strings between single quotes (<parameter>'string'</parameter>) are
                        treated literally, you do not have to escape special characters. This makes
                        writing and reading regular expressions much more simple: it is recommended
                        to use single quotes when writing regular expressions.</para>
                </listitem>
                <listitem>
                    <para>When enclosing strings between double-quotes
                        (<parameter>"string"</parameter>), you have to escape special characters:
                        for example when enclosing a regular expression that uses the
                        <parameter>\</parameter> character to escape a special character, you have
                        to add an extra <parameter>\</parameter> (for example
                        <parameter>"\\n"</parameter>). It is recommended to use single quotes
                        instead.</para>
                </listitem>
                <listitem>
                    <para>Enclosing normal strings between double-quotes
                        (<parameter>"string"</parameter>) is not necessary, you can just omit the
                        double-quotes. For example when writing filters,
                        <parameter>match("sometext")</parameter> and
                        <parameter>match(sometext)</parameter> will both match for the
                            <parameter>sometext</parameter> string.</para>
                </listitem>
                <listitem>
                    <para>When enclosing object IDs (for example the name of a destination) between
                        double-quotes (<parameter>"mydestination"</parameter>), the ID can include
                        whitespace as well, for example:</para>
                    <synopsis>source "s demo stream" { 
                        unix-stream("/dev/log" max-connections(10) group(log)); };</synopsis>
                </listitem>
            </itemizedlist>

        </section>

    </section>
    <section id="options">
        <title>Configuring global syslog-ng options</title>
        <indexterm significance="preferred">
            <primary>global options</primary>
        </indexterm>
        <para id="options_para1">The syslog-ng application has a number of global options governing
            DNS usage, the timestamp format used, and other general points. Each option may have
            parameters, similarly to driver specifications. To set global options, add an option
            statement to the syslog-ng configuration file using the following syntax:</para>
        <synopsis id="options_synopsis">options { option1(params); option2(params); ... };</synopsis>
        <example>
            <title>Using global options</title>
            <para>To disable domain name resolving, add the following line to the syslog-ng
                configuration file:</para>
            <synopsis>options { use_dns(no); };</synopsis>
        </example>
        <para>For a detailed list of the available options, see <xref linkend="reference_options"/>.
            See <xref linkend="chapter_examples"/> for important global options and recommendations
            on their use.</para>
    </section>

    <section id="configure_clients">
        <title>Configuring syslog-ng clients</title>
        <indexterm>
            <primary>syslog-ng clients</primary>
            <secondary>configuring</secondary>
        </indexterm>
        <para>To configure syslog-ng on a client host, complete the following steps:</para>
        <procedure>
            <title>Configuring syslog-ng on client hosts</title>
            <step>
                <para>Install the syslog-ng application on the host. See <xref
                        linkend="chapter_install"/> for details installing syslog-ng on specific
                    operating systems.</para>
            </step>
            <step>
                <para>Configure the local sources that collect the log messages of the host.</para>
            </step>
            <step>
                <para>Create a network destination that points directly to the syslog-ng server, or
                    to a local relay.</para>
            </step>
            <step>
                <para>Create a log statement connecting the local sources to the syslog-ng server or
                    relay.</para>
            </step>
            <step>
                <para>If the logs will also be stored locally on the host, create local file
                    destinations.</para>
            </step>
            <step>
                <para>Create a log statement connecting the local sources to the file
                destination.</para>
            </step>
            <step>
                <para>Set filters and options (for example TLS encryption) as necessary.</para>
            </step>
        </procedure>
        <example id="example_clientconfig">
            <title>A simple configuration for clients</title>
            <para>The following is a simple configuration file that collects local log messages and
                forwards them to a logserver using the IETF-syslog protocol.</para>
            <synopsis>@version:3.0
               
options { 
            mark_freq(30);
        };
                
source s_local { unix-stream("/dev/log"); internal(); };
 
destination d_syslog_tcp {
             syslog("192.168.1.1" transport("tcp") port(2010));
        };
                
log { source(s_local);destination(d_syslog_tcp); };</synopsis>
        </example>

    </section>

    <section id="configure_relays">
        <title>Configuring syslog-ng relays</title>
        <indexterm>
            <primary>syslog-ng relays</primary>
            <secondary>configuring</secondary>
        </indexterm>
        <para>To configure syslog-ng on a relay host, complete the following steps:</para>
        <procedure>
            <title>Configuring syslog-ng on relay hosts</title>
            <step>
                <para>Install the syslog-ng application on the host. See <xref
                        linkend="chapter_install"/> for details installing syslog-ng on specific
                    operating systems.</para>
            </step>
            <step>
                <para>Configure the network sources that collect the log messages sent by the
                    clients.</para>
            </step>
            <step>
                <para>Create a network destination that points to the syslog-ng server.</para>
            </step>
            <step>
                <para>Create a log statement connecting the network sources to the syslog-ng
                server.</para>
            </step>
            <step>
                <para>Configure the local sources that collect the log messages of the relay
                host.</para>
            </step>
            <step>
                <para>Create a log statement connecting the local sources to the syslog-ng
                server.</para>
            </step>
            <step>
                <para>Set filters and options (for example TLS encryption) as necessary.</para>
                <note>
                    <xi:include href="reference_common.xml" xpointer="xpointer(//note[@id = 'note-relaying-hostname']/node() )" xmlns:xi="http://www.w3.org/2001/XInclude"/>
                </note>
            </step>
        </procedure>
        <para>In relay mode, syslog-ng cannot write messages received from network sources into
            files; the <parameter>file()</parameter> destination is disabled. The following sources
            are network sources: <parameter>syslog()</parameter>, <parameter>tcp()</parameter>,
                <parameter>tcp6()</parameter>, <parameter>udp()</parameter>,
            <parameter>udp6()</parameter>.</para>
        <example id="example_relayconfig">
            <title>A simple configuration for relays</title>
            <para>The following is a simple configuration file that collects local and incoming log
                messages and forwards them to a logserver using the IETF-syslog protocol.</para>
            <synopsis>@version:3.0
                
                options { 
                mark_freq(30);
                keep_hostname(yes);                
                };
                
                source s_local { unix-stream("/dev/log"); internal(); };
                source s_network { syslog(transport(tcp))};
                
                destination d_syslog_tcp {
                syslog("192.168.1.5" transport("tcp") port(2010)
                );
                };
                
                log { source(s_local); source(s_network); 
                      destination(d_syslog_tcp); };</synopsis>
        </example>
    </section>

    <section id="configure_servers">
        <title>Configuring syslog-ng servers</title>
        <indexterm>
            <primary>syslog-ng servers</primary>
            <secondary>configuring</secondary>
        </indexterm>
        <para>To configure syslog-ng on a server host, complete the following steps:</para>
        <procedure>
            <title>Configuring syslog-ng on server hosts</title>
            <step>
                <para>Install the syslog-ng application on the host. See <xref
                        linkend="chapter_install"/> for details installing syslog-ng on specific
                    operating systems.</para>
            </step>
            <step>
                <para>Configure the network sources that collect the log messages sent by the
                    clients and relays.</para>
            </step>
            <step>
                <para>Create local destinations that will store the log messages, for example files or
                    programs.</para>
            </step>
            <step>
                <para>Create a log statement connecting the network sources to the local
                    destinations.</para>
            </step>
            <step>
                <para>Configure the local sources that collect the log messages of the syslog-ng
                    server.</para>
            </step>
            <step>
                <para>Create a log statement connecting the local sources to the local
                destinations.</para>
            </step>
            <step>
                <para>Set filters, options (for example TLS encryption) and other advanced features as
                    necessary.</para>
                <note>
                    <xi:include href="reference_common.xml" xpointer="xpointer(//note[@id = 'note-relaying-hostname']/node() )" xmlns:xi="http://www.w3.org/2001/XInclude"/>
                </note>
            </step>
        </procedure>
        <example id="example_serverconfig">
            <title>A simple configuration for servers</title>
            <para>The following is a simple configuration file for &product; that
                collects incoming log messages and stores them in a text file.</para>
            <synopsis>@version:3.0
    options { 
        time_reap(30);
        mark_freq(10);
        keep_hostname(yes);
        };
                
    source s_local { unix-stream("/dev/log"); internal();};                
    source s_network { syslog(transport(tcp))};
                
    destination d_logs { 
        file(
            "/var/log/syslog-ng/logs.txt"
            owner("root")
            group("root")
            perm(0777)
            ); };
                
    log { source(s_local); source(s_network); destination(d_logs); };</synopsis>
        </example>
    </section>
</chapter>
