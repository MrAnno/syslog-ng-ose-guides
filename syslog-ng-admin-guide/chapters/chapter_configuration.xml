<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter SYSTEM "../../xml-stylesheet/pdf/dtd/docbookx.dtd"
 [  <!ENTITY % entities SYSTEM "../syslog-ng-entities.ent">
 %entities;]> 
<chapter id="chapter_configuration">
    <title>Configuring syslog-ng</title>
    <indexterm>
        <primary>configuring syslog-ng</primary>
        <secondary>on Linux/Unix</secondary>
    </indexterm>
    <para>This chapter describes how to configure syslog-ng. </para>

    <section id="options">
        <title>Configuring global syslog-ng options</title>
        <indexterm significance="preferred">
            <primary>global options</primary>
        </indexterm>
        <para id="options_para1">The syslog-ng application has a number of global options governing
            DNS usage, the timestamp format used, and other general points. Each option may have
            parameters, similarly to driver specifications. To set global options, add an option
            statement to the syslog-ng configuration file using the following syntax:</para>
        <synopsis id="options_synopsis">options { option1(params); option2(params); ... };</synopsis>
        <example>
            <title>Using global options</title>
            <para>To disable domain name resolving, add the following line to the syslog-ng
                configuration file:</para>
            <synopsis>options { use_dns(no); };</synopsis>
        </example>
        <para>For a detailed list of the available options, see <xref linkend="reference_options"/>.
            See <xref linkend="chapter_examples"/> for important global options and recommendations
            on their use.</para>
    </section>

    <section id="configure_clients">
        <title>Configuring syslog-ng clients</title>
        <indexterm>
            <primary>syslog-ng clients</primary>
            <secondary>configuring</secondary>
        </indexterm>
        <para>To configure syslog-ng on a client host, complete the following steps:</para>
        <procedure>
            <title>Configuring syslog-ng on client hosts</title>
            <step>
                <para>Install the syslog-ng application on the host. See <xref
                        linkend="chapter_install"/> for details installing syslog-ng on specific
                    operating systems.</para>
            </step>
            <step>
                <para>Configure the local sources that collect the log messages of the host.</para>
            </step>
            <step>
                <para>Create a network destination that points directly to the syslog-ng server, or
                    to a local relay.</para>
            </step>
            <step>
                <para>Create a log statement connecting the local sources to the syslog-ng server or
                    relay.</para>
            </step>
            <step>
                <para>If the logs will also be stored locally on the host, create local file
                    destinations.</para>
            </step>
            <step>
                <para>Create a log statement connecting the local sources to the file
                destination.</para>
            </step>
            <step>
                <para>Set filters and options (for example TLS encryption) as necessary.</para>
            </step>
        </procedure>
        <example id="example_clientconfig">
            <title>A simple configuration for clients</title>
            <para>The following is a simple configuration file that collects local log messages and
                forwards them to a logserver using the IETF-syslog protocol.</para>
            <synopsis>@version:3.0
               
options { 
            mark_freq(30);
        };
                
source s_local { unix-stream("/dev/log"); internal(); };
 
destination d_syslog_tcp {
             syslog("192.168.1.1" transport("tcp") port(2010));
        };
                
log { source(s_local);destination(d_syslog_tcp); };</synopsis>
        </example>

    </section>

    <section id="configure_relays">
        <title>Configuring syslog-ng relays</title>
        <indexterm>
            <primary>syslog-ng relays</primary>
            <secondary>configuring</secondary>
        </indexterm>
        <para>To configure syslog-ng on a relay host, complete the following steps:</para>
        <procedure>
            <title>Configuring syslog-ng on relay hosts</title>
            <step>
                <para>Install the syslog-ng application on the host. See <xref
                        linkend="chapter_install"/> for details installing syslog-ng on specific
                    operating systems.</para>
            </step>
            <step>
                <para>Configure the network sources that collect the log messages sent by the
                    clients.</para>
            </step>
            <step>
                <para>Create a network destination that points to the syslog-ng server.</para>
            </step>
            <step>
                <para>Create a log statement connecting the network sources to the syslog-ng
                server.</para>
            </step>
            <step>
                <para>Configure the local sources that collect the log messages of the relay
                host.</para>
            </step>
            <step>
                <para>Create a log statement connecting the local sources to the syslog-ng
                server.</para>
            </step>
            <step>
                <para>Set filters and options (for example TLS encryption) as necessary.</para>
                <note>
                    <xi:include href="reference_common.xml" xpointer="xpointer(//note[@id = 'note-relaying-hostname']/node() )" xmlns:xi="http://www.w3.org/2001/XInclude"/>
                </note>
            </step>
        </procedure>
        <para>In relay mode, syslog-ng cannot write messages received from network sources into
            files; the <parameter>file()</parameter> destination is disabled. The following sources
            are network sources: <parameter>syslog()</parameter>, <parameter>tcp()</parameter>,
                <parameter>tcp6()</parameter>, <parameter>udp()</parameter>,
            <parameter>udp6()</parameter>.</para>
        <example id="example_relayconfig">
            <title>A simple configuration for relays</title>
            <para>The following is a simple configuration file that collects local and incoming log
                messages and forwards them to a logserver using the IETF-syslog protocol.</para>
            <synopsis>@version:3.0
                
                options { 
                mark_freq(30);
                keep_hostname(yes);                
                };
                
                source s_local { unix-stream("/dev/log"); internal(); };
                source s_network { syslog(transport(tcp))};
                
                destination d_syslog_tcp {
                syslog("192.168.1.5" transport("tcp") port(2010)
                );
                };
                
                log { source(s_local); source(s_network); 
                      destination(d_syslog_tcp); };</synopsis>
        </example>
    </section>

    <section id="configure_servers">
        <title>Configuring syslog-ng servers</title>
        <indexterm>
            <primary>syslog-ng servers</primary>
            <secondary>configuring</secondary>
        </indexterm>
        <para>To configure syslog-ng on a server host, complete the following steps:</para>
        <procedure>
            <title>Configuring syslog-ng on server hosts</title>
            <step>
                <para>Install the syslog-ng application on the host. See <xref
                        linkend="chapter_install"/> for details installing syslog-ng on specific
                    operating systems.</para>
            </step>
            <step>
                <para>Configure the network sources that collect the log messages sent by the
                    clients and relays.</para>
            </step>
            <step>
                <para>Create local destinations that will store the log messages, for example files or
                    programs.</para>
            </step>
            <step>
                <para>Create a log statement connecting the network sources to the local
                    destinations.</para>
            </step>
            <step>
                <para>Configure the local sources that collect the log messages of the syslog-ng
                    server.</para>
            </step>
            <step>
                <para>Create a log statement connecting the local sources to the local
                destinations.</para>
            </step>
            <step>
                <para>Set filters, options (for example TLS encryption) and other advanced features as
                    necessary.</para>
                <note>
                    <xi:include href="reference_common.xml" xpointer="xpointer(//note[@id = 'note-relaying-hostname']/node() )" xmlns:xi="http://www.w3.org/2001/XInclude"/>
                </note>
            </step>
        </procedure>
        <example id="example_serverconfig">
            <title>A simple configuration for servers</title>
            <para>The following is a simple configuration file for &product; that
                collects incoming log messages and stores them in a text file.</para>
            <synopsis>@version:3.0
    options { 
        time_reap(30);
        mark_freq(10);
        keep_hostname(yes);
        };
                
    source s_local { unix-stream("/dev/log"); internal();};                
    source s_network { syslog(transport(tcp))};
                
    destination d_logs { 
        file(
            "/var/log/syslog-ng/logs.txt"
            owner("root")
            group("root")
            perm(0777)
            ); };
                
    log { source(s_local); source(s_network); destination(d_logs); };</synopsis>
        </example>
    </section>
</chapter>
