<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE appendix SYSTEM "../../xml-stylesheet/pdf/dtd/docbookx.dtd"
[  
  <!ENTITY % xinclude SYSTEM "../../xml-stylesheet/pdf/dtd/xinclude.mod" >
  %xinclude;
  <!ENTITY % entities SYSTEM "../syslog-ng-entities.ent">
  %entities;]> 
<appendix id="chapter_windows_agent_2.1">
    <title>Using syslog-ng Agent for Windows version 2.1</title>
    <indexterm>
        <primary>configuring syslog-ng</primary>
        <secondary>on Windows</secondary>
    </indexterm>
    <indexterm>
        <primary>syslog-ng agent</primary>
        <secondary>version 2.1</secondary>
    </indexterm>
    <para>This chapter describes how to install and configure the syslog-ng Agent for Windows
        application on Microsoft Windows hosts.</para>
    <note>
        <para>This chapter applies to version 2.1 of the syslog-ng Agent for Windows application.
            The documentation of the current version (2.2 and later) is available at <xref
                linkend="chapter_windows"/>.</para>
    </note>
    <para>The syslog-ng Agent for Windows is a log collector and forwarder application for the
        Microsoft Windows platform. It collects the log messages of the Windows-based host and
        forwards them to a syslog-ng server using regular or TLS-encrypted TCP connections.</para>
    <para>The features and restrictions of the syslog-ng agent are summarized below:</para>
    <itemizedlist>
        <listitem>
            <para>Reads messages from eventlog groups and log files.</para>
        </listitem>
        <listitem>
            <para>Transfers log messages using TCP.</para>
        </listitem>
        <listitem>
            <para>Supports TLS encryption.</para>
        </listitem>
        <listitem>
            <para>Authenticates the server using X.509 certificates. Mutual authentication is also
                supported.</para>
        </listitem>
        <listitem>
            <para>The format of eventlog messages can be customized using macros.</para>
        </listitem>
    </itemizedlist>
    <para>The syslog-ng agent supports the following operating systems:</para>
    <indexterm>
        <primary>supported operating systems</primary>
    </indexterm>
    <itemizedlist>
        <listitem>
            <para>Microsoft Windows Server 2003</para>
        </listitem>
        <listitem>
            <para>Microsoft Windows XP</para>
        </listitem>
        <listitem>
            <para>Microsoft Windows Vista</para>
        </listitem>
    </itemizedlist>
    <section id="windows_install_agent_2.1">
        <title>Installing and configuring the syslog-ng agent</title>
        <indexterm>
            <primary>installing syslog-ng</primary>
            <secondary>syslog-ng agent version 2.1</secondary>
        </indexterm>
        <para>To install the syslog-ng agent, complete the following steps.</para>
        <note>
            <para>To install and configure the syslog-ng agent without any user interaction, see
                    <xref linkend="windows_install_agent_2.1_silent"/>.</para>
        </note>
        <procedure>
            <title>Installing the syslog-ng agent on Microsoft Windows</title>
            <step>
                <para>Start the installer. Run the <filename>syslog-ng-agent-setup.exe</filename>
                    file.</para>
                <note>
                    <para>Installing the syslog-ng agent requires administrator privileges.</para>
                </note>
            </step>
            <step>
                <para>Select the destination folder in which to install the syslog-ng agent
                    application, then click <guibutton>Install</guibutton>. By default, the
                    installer selects the <filename>C:\Program Files\Syslog-NG Agent</filename>
                    folder. The syslog-ng agent requires about 1 MB hard disk space.</para>
            </step>
            <step>
                <para>Configure the connection to the syslog-ng server. Enter the name (e.g.,
                        <parameter>syslog-ng.example.com</parameter> or the IP address of the
                    syslog-ng server into the <guilabel>Server name</guilabel> field. Enter the port
                    where the syslog-ng server accepts connections into the <guilabel>Server
                    port</guilabel> field. Usually syslog-ng servers accept connections on port
                        <parameter>514</parameter>. </para>
            </step>
            <step>
                <para>Select the mode of the connection.</para>
                <para>To use unencrypted TCP connections, select <guibutton>Unencrypted</guibutton>.
                    To use secure, SSL-encrypted connections, select
                    <guibutton>Encrypted</guibutton>.</para>
            </step>
            <step>
                <indexterm>
                    <primary>throttle</primary>
                    <secondary>on Windows</secondary>
                </indexterm>
                <indexterm>
                    <primary>message rate</primary>
                    <secondary>on Windows</secondary>
                </indexterm>
                <indexterm>
                    <primary>syslog-ng Agent</primary>
                    <secondary>throttle</secondary>
                </indexterm>
                <para>To limit the number of messages that the syslog-ng Agent sends to the server
                    in a second, enter the desired limit into the <guilabel>Throttling</guilabel>
                    field. By default (<parameter>0</parameter>), the syslog-ng Agent does not limit
                    the number of messages sent.</para>
                <note>
                    <para>The throttling parameter applies to the total number of messages sent, not
                        to every source independently.</para>
                </note>
                <para>Click <guibutton>Next</guibutton>.</para>
            </step>
            <step>
                <para>Select the eventlog sources. The syslog-ng agent can handle both default and
                    custom eventlog containers. Press and hold the Control (Ctrl) key to select
                    multiple groups, or to unselect an already selected group. The syslog-ng agent
                    forwards messages only from the selected eventlog groups. </para>
            </step>
            <step>
                <para>Select the file sources. </para>
                <para>To select single files, click the <guibutton>...</guibutton> button, select
                    the file, then click <guibutton>Add log file</guibutton>. </para>
                <para>To select files that are regularly rotated, add an expression in the
                        <guilabel>Expression</guilabel> field and click <guibutton>Add
                    expression</guibutton>. See <xref linkend="windows_logrotate"/> on using
                    wildcards in the file sources.</para>
                <note>
                    <para>The syslog-ng agent remembers the position of the last sent message from
                        every file, and does not re-send old messages if the application is
                        restarted.</para>
                </note>
            </step>
            <step>
                <para>Click <guibutton>Next</guibutton> when you have added every necessary log
                    source.</para>
            </step>
            <step>
                <para>If needed, customize the format of the messages sent to the central syslog-ng
                    server. See <xref linkend="windows_message_format"/> for details. Click
                        <guibutton>Save settings</guibutton>.</para>
            </step>
            <step>
                <para>After the installation has finished, click
                <guibutton>Close</guibutton>.</para>
            </step>
            <step>
                <para>Use the <command>eventcreate</command> command from the command prompt to
                    create test messages in the event log. The following command creates an event in
                    the application log: <command>eventcreate /t information /id 100 /l application
                        /d "Test event in application log"</command>. If you have selected the
                        <emphasis>Application</emphasis> eventlog source when you configured the
                    syslog-ng agent, the test message will appear in the logs of the central
                    syslog-ng server.</para>
                <para>Consult the documentation of your operating system for details on using
                        <command>eventcreate</command>.</para>
                <para>For Windows Server 2003, see </para>
                <para><ulink
                        url="http://technet2.microsoft.com/windowsserver/en/library/7091b848-90c3-4924-a26d-92494daac4621033.mspx?mfr=true"
                        >http://technet2.microsoft.com/windowsserver/en/library/7091b848-90c3-4924-a26d-92494daac4621033.mspx?mfr=true</ulink>.</para>
                <para>For Windows XP, see </para>
                <para>
                    <ulink
                        url="http://www.microsoft.com/resources/documentation/windows/xp/all/proddocs/en-us/eventcreate.mspx?mfr=true"
                        >http://www.microsoft.com/resources/documentation/windows/xp/all/proddocs/en-us/eventcreate.mspx?mfr=true</ulink>
                </para>
            </step>
        </procedure>
        <indexterm>
            <primary>configuring syslog-ng</primary>
            <secondary>syslog-ng agent version 2.1</secondary>
        </indexterm>
        <para>To configure an already installed syslog-ng agent, select <guibutton>Start Menu >
                Programs > Syslog-NG Agent for Windows > Configure Syslog-NG Agent</guibutton>.</para>
        <section id="windows_install_agent_2.1_silent">
            <title>Installing the syslog-ng agent without user-interaction</title>
            <indexterm>
                <primary>installing syslog-ng</primary>
                <secondary>syslog-ng agent version 2.1 - silent install</secondary>
            </indexterm>
            <indexterm>
                <primary>installing syslog-ng</primary>
                <secondary>syslog-ng agent version 2.1 without user-interaction</secondary>
            </indexterm>
            <para>To install and configure the syslog-ng Agent for Windows application without
                user-interaction, complete the following procedure. The silent installer uses a
                standard INI file.</para>
            <note>
                <para>The following procedures applies only for syslog-ng Agent for Windows version
                    2.1.5.</para>
            </note>
            <procedure>
                <title>Installing the syslog-ng agent without user-interaction</title>
                <step>
                    <para>Start a text editor and create an INI file, e.g.,
                            <filename>syslog-ng-agent.ini</filename>. The installer will configure
                        the agent using this file.</para>
                </step>
                <step>
                    <para>To change the folder where the syslog-ng agent will be installed, add the
                        following lines to the beginning of the INI file. Modify the path as needed
                        for your environment.</para>
                    <synopsis>[install]
                        InstallDir = C:\Program Files\Syslog-NG Agent</synopsis>
                </step>
                <step>
                    <para>Specify the IP address of the server where the agent sends the log
                        messages. The port number is required only if it is different from the
                        standard <parameter>514</parameter>.</para>
                    <synopsis>[config]
ServerIP = 192.168.1.1
ServerPort = 514</synopsis>
                    <para>If you do not specify anything else in the INI file, syslog-ng will be
                        installed into the <filename>C:\Program Files\Syslog-NG Agent</filename>
                        folder, and will send messages from the System, Security, and Applications
                        event log containers to the specified servers using an unencrypted TCP
                        connection. Further customization of the INI file is needed only to specify
                        SSL-encryption parameters, message sources, the format and timestamp of the
                        messages, or to change the installation directory.</para>
                </step>
                <step>
                    <para>To specify the log sources, add the following lines to the
                            <parameter>[config]</parameter> section of the INI file. Log sources
                        must be separated with the <parameter>|</parameter> character. Modify the
                        names of the Eventlog containers and log files as needed. See <xref
                            linkend="windows_logrotate_agent_2.1"/> for details on specifying the
                        file sources.</para>
                    <synopsis>EventLogContainer = System|Security|Applications
LogFile=C:\Logs\example1.log|C:\Logs2\*.log</synopsis>
                </step>
                <step>
                    <para>To customize the format of the log messages, add the following lines to
                        the <parameter>[config]</parameter> section of the INI file. The format of
                        the timestamp can be <parameter>iso</parameter> and
                        <parameter>bsd</parameter>. See <xref
                            linkend="windows_message_format_agent_2.1"/> for details on
                        customizing the message format.</para>
                    <synopsis>LogFormat=&lt;${PRI}&gt;: $DATE $HOST ${USERNAME}:  ${EVENT_NAME} ${EVENT_SOURCE}: [${EVENT_TYPE}]  ${MSG} (EventID ${EVENT_ID})
DateTimeFormat=iso</synopsis>
                </step>
                <step>
                    <para>To send the log messages using SSL-encryption, enable encryption and
                        specify the file containing the certificate of the Certificate Authority
                        (CA) that issued the certificate of the log server. The CA certificate must
                        be in DER format.</para>
                    <synopsis>ConnMode = ssl
ServerCAPath = logserver-cacert.der</synopsis>
                    <note>
                        <para>If the server authenticates the clients as well, see <xref
                                linkend="windows_ssl_agent_2.1_mutual_agent_2.1"/></para>
                    </note>
                </step>
                <step>
                    <para>To limit the number of messages (per second) sent to the server, add the
                        following line to the <parameter>[config]</parameter> section of the INI
                        file. By default, this limitation is disabled (<parameter>0</parameter>).</para>
                    <synopsis>Throttling = 0</synopsis>
                </step>
                <step>
                    <para>Select <guimenu>Start > Run</guimenu>, and start the installer with the
                        following parameters: <parameter>syslog-ng-agent-setup-2.1.5.exe /S
                            /CONFIG=&lt;inifile&gt;</parameter>. The
                            <parameter>&lt;inifile&gt;</parameter> parameter may include the
                        path to the file; otherwise the installer assumes it is located in the
                        current folder.</para>
                    <warning>
                        <para>The command-line parameters of the agent are all capitals.</para>
                    </warning>
                </step>
            </procedure>
        </section>
    </section>
    <section id="windows_logrotate_agent_2.1">
        <title>File sources and logrotation</title>
        <para>The syslog-ng agent supports the use of wildcards (<parameter>*</parameter>) in
            filenames and foldernames to be able to follow log files that are automatically rotated.</para>
        <para>To follow the logfiles stored in a directory, modify the syslog-ng agent
            configuration. Add an expression that contains the path to the files. Use the
                <parameter>*</parameter> wildcard in the filename, for example:
                <parameter>C:\logs\webserver\*.log</parameter>. </para>
        <para>To follow the logfiles stored in a set of directories, modify the syslog-ng agent
            configuration. Add an expression that contains the path to the directories. Use the
                <parameter>**</parameter> wildcard in the name of the directories, and the
                <parameter>*</parameter> wildcard in the filename, for example:
                <parameter>C:\logs\webserver\**\*.log</parameter>. This format is useful for
            applications that store their logs in timestamped directories.</para>
        <para>It is important to note that syslog-ng agent reads messages only from one file for
            every expression. If multiple applications log into the same folder, you have to add a
            separate expression for every application. The expression must match to the log files of
            the respective application. Also, if an old file on a folder is modified by an
            application, the syslog-ng agent resends the entire file.</para>
        <note>
            <para>If an application writes a message into a log file without ending the line with a
                new-line character, saves (closes) the file, and later continues to write into the
                same line, then this is visible in the file as a single line, but the syslog-ng
                agent interprets them as two separate messages.</para>
        </note>
        <example>
            <title>Collecting the logs of multiple applications from a single folder</title>
            <para>The following expressions define two sources to collect the logs of
                    <parameter>application1</parameter> and <parameter>application2</parameter>
                which both log into the <filename>C:\logs</filename> folder.</para>
            <para>Expression 1: <parameter>C:\logs\application1*.log</parameter></para>
            <para>Expression 2: <parameter>C:\logs\application2*.log</parameter></para>
            <para>If other applications log into the <filename>C:\logs</filename> folder, add a
                separate expression for each application.</para>
        </example>
    </section>
    <section id="windows_ssl_agent_2.1">
        <title>Using SSL-encrypted connections with the syslog-ng agent</title>
        <indexterm>
            <primary>authentication</primary>
            <secondary>syslog-ng agent version 2.1</secondary>
        </indexterm>
        <indexterm>
            <primary>TLS</primary>
            <secondary>syslog-ng agent version 2.1</secondary>
        </indexterm>
        <indexterm>
            <primary>certificates</primary>
        </indexterm>
        <para>When connecting to a syslog-ng server using an encrypted connection, the syslog-ng
            agent verifies the certificate of the server. The connection is established only if the
            Certificate Authority (CA) that issued the certificate of the server is available in the
            Certificate Store (in the <parameter>CERT_SYSTEM_STORE_LOCAL_MACHINE\Root
            store</parameter>) of the Windows-based host. Use one of the following methods to add
            the certificate of the CA to the host computers: </para>
        <xi:include href="chapter_configuration.xml" xmlns:xi="http://www.w3.org/2001/XInclude"
            xpointer="element(cert_common_name)"/>
        <itemizedlist>
            <listitem>
                <para>Select the certificate when installing or configuring the syslog-ng agent
                    application. The certificate will be automatically added to the
                        <guilabel>Certificates</guilabel> section of the <guilabel>Trusted Root
                        Certificate Authorities</guilabel> on the Local Computer.</para>
            </listitem>
            <listitem>
                <para>Import the certificate manually. Run the <filename>addcert.exe</filename>
                    application from the command prompt and specify the certificate as a parameter.
                    E.g., </para>
                <synopsis>C:\Program Files\syslog-ng\addcert C:\temp\syslog-ng_CA.crt</synopsis>
                <para>The <filename>addcert.exe</filename> file is located in the same folder as the
                    other syslog-ng agent files.</para>
                <note>
                    <para>The <filename>addcert.exe</filename> utility can import only the
                        certificate of the syslog-ng server. Currently it cannot import certificates
                        used for mutual authentication.</para>
                </note>
            </listitem>
            <listitem>
                <para>Import the certificate using the Microsoft Management Console application
                    (MMC). See <xref linkend="syslog-ng_importcert"/> for details.</para>
                <note>
                    <para>The certificate must be in DER format.</para>
                </note>
            </listitem>            
        </itemizedlist>

        <procedure id="syslog-ng_importcert">
            <title>Importing the syslog-ng certificates with MMC</title>
            <para>Complete the following steps to import the certificates used by syslog-ng.</para>
            <note>
                <para>The CA certificate used to authenticate the syslog-ng server must be in DER
                    format.</para>
                <para>The certificate used to authenticate the syslog-ng agent on the server for
                    mutual authentication must be in PKCS12 format and must include the private key
                    of the certificate.</para>
            </note>
            <step>
                <para>Start Microsoft Management Console by executing <filename>mmc.exe</filename>
                        (<guimenu>Start</guimenu> menu <guimenu>Run application</guimenu>). </para>
                <note>
                    <para>Running <filename>mmc.exe</filename> requires administrator
                    privileges.</para>
                </note>
            </step>
            <step>
                <para>Click on the <guimenu>Add/Remove snap-in</guimenu> item of the
                    <guimenu>File</guimenu> menu.</para>
            </step>
            <step>
                <para>Click <guimenu>Add</guimenu>, select the <guimenu>Certificates</guimenu>
                    module, and click <guimenu>Add</guimenu>.</para>
            </step>
            <step>
                <para>Select <guimenu>Computer account</guimenu> in the displayed window and click
                        <guimenu>Next</guimenu>.</para>
            </step>
            <step>
                <para>Select <guimenu>Local computer</guimenu> and click <guimenu>Close</guimenu>.
                </para>
            </step>
            <step>
                <para>To import the certificate of the syslog-ng server, navigate to
                        <guimenu>Console Root \ Certificates \ Trusted Root Certificate Authorities
                        \ Certificates</guimenu>.</para>
                <para>To import a certificate for the syslog-ng agent to perform mutual
                    authentication, navigate to <guimenu>Console Root \ Certificates \ Personal \
                        Certificates</guimenu>.</para>
            </step>
            <step>
                <para>Right-click on the <guibutton>Certificates</guibutton> folder and from the
                    appearing menu select <guibutton>All tasks</guibutton> /
                    <guibutton>Import</guibutton>. The <guibutton>Certificate Import
                    Wizard</guibutton> will be displayed. Click <guibutton>Next</guibutton>.</para>
            </step>
            <step>
                <para>Select the certificate to import (e.g.:
                    <filename>C:/tmp/mycert.crt</filename>) and click <guibutton>Next</guibutton>.</para>
                <para><emphasis>Optional step</emphasis>: Certificates used to authenticate the
                    syslog-ng agent in mutual authentication include the private key. Provide the
                    password for the private key when requested.</para>
            </step>
            <step>
                <para>Windows offers a suitable certificate store by default, so click
                        <guibutton>Next</guibutton>.</para>
            </step>
            <step>
                <para>Click <guibutton>Finish</guibutton> on the summary window and
                    <guibutton>OK</guibutton> on the window that marks the successful importing of
                    the certificate. The main window of MMC is displayed with the imported
                    certificate.</para>
            </step>
        </procedure>

        <section id="windows_ssl_agent_2.1_mutual_agent_2.1">
            <title>Using mutual authentication with syslog-ng agent</title>
            <indexterm>
                <primary>syslog-ng agent version 2.1</primary>
                <secondary>mutual authentication</secondary>
            </indexterm>
            <indexterm>
                <primary>syslog-ng agent version 2.1</primary>
                <secondary>client authentication</secondary>
            </indexterm>
            <indexterm>
                <primary>mutual authentication</primary>
                <secondary>syslog-ng agent version 2.1</secondary>
            </indexterm>
            <indexterm>
                <primary>client authentication</primary>
                <secondary>syslog-ng agent version 2.1</secondary>
            </indexterm>
            <para>When the syslog-ng server is configured to use mutual authentication, it requests
                a certificate from the syslog-ng clients. The syslog-ng agent can automatically show
                the requested certificate to the server when the connection is established if it is
                available in the <guilabel>Personal Certificates</guilabel> store (in the
                    <parameter>CERT_SYSTEM_STORE_LOCAL_MACHINE\My store</parameter>) of the Local
                Computer. Use the Microsoft Management Console application (MMC) to import this
                certificate. See <xref linkend="syslog-ng_importcert"/> for details.</para>
            <note>
                <para>If the syslog-ng agent cannot find a suitable certificate in the Local
                    Computer/Personal Certificates store, it also checks the Personal Certificates
                    store of the LogRelay service. If the syslog-ng agent was started manually, the
                    Personal Certificates store of the current user is also checked.</para>
            </note>
            <note>
                <indexterm>
                    <primary>syslog-ng agent version 2.1</primary>
                    <secondary>certificate revocation lists</secondary>
                </indexterm>
                <indexterm>
                    <primary>syslog-ng agent version 2.1</primary>
                    <secondary>CRL</secondary>
                </indexterm>

                <indexterm>
                    <primary>certificate revocation lists</primary>
                    <secondary>syslog-ng agent version 2.1</secondary>
                </indexterm>
                <indexterm>
                    <primary>CRL</primary>
                    <secondary>syslog-ng agent version 2.1</secondary>
                </indexterm>
                <para>If a certificate revocation list (CRL) is available in the Local
                    Computer/Personal Certificates store, the syslog-ng agent verifies that the
                    certificate of the syslog-ng server is not on this list.</para>
            </note>
            <procedure id="proc_windows_ssl_agent_2.1_mutual">
                <title>Configuring mutual authentication with the syslog-ng Agent for Windows</title>
                <para>If the syslog-ng server requests authentication from the syslog-ng Agent,
                    complete the following steps.</para>
                <step>
                    <para>Create certificates for the clients. By default, the syslog-ng agent will
                        look for a certificate that contains the hostname or IP address of the
                        central syslog-ng server in its Common Name. If you use a different Common
                        Name, do not forget to complete Step 3 to set the Common Name in the
                        registry.</para>
                    <para>The certificate must contain the private key and must be in PKCS12 format.</para>
                    <tip>
                        <para>To convert a certificate and a key from PEM format to PKCS12 you can
                            use the following command:</para>
                        <para>
                            <synopsis>openssl pkcs12 -export -in agentcertificate.pem -inkey agentprivatekey.pem -out agentcertificatewithkey.pfx </synopsis>
                        </para>
                    </tip>
                </step>
                <step>
                    <para>Import this certificate into the <guilabel>Personal Certificate</guilabel>
                        store of the Local Computer using the Microsoft Management Console
                        application (MMC). See <xref linkend="syslog-ng_importcert"/> for
                    details.</para>
                </step>
                <step>
                    <para>By default, the syslog-ng agent will look for a certificate that contains
                        the hostname or IP address of the central syslog-ng server in its Common
                        Name. If the certificate of the client has a different Common Name, complete
                        the following steps:</para>
                    <para><emphasis>Optional step</emphasis>: To explicitly specify the certificate
                        that the client shows to the server, add the contents of the
                            <parameter>subject_alt_name</parameter> parameter (or the
                            <parameter>Common Name</parameter> parameter if the
                            <parameter>subject_alt_name</parameter> parameter is empty) to the
                        Windows registry. Complete the following steps: </para>
                    <substeps>
                        <step>
                            <para>Select <guimenu>Start > Run</guimenu> and enter
                                <command>regedit</command>.</para>
                        </step>
                        <step>
                            <para>Navigate to
                                    <parameter>HKEY_LOCAL_MACHINE\SOFTWARE\BalaBit\LogRelay\Destinations\Network\IPv4</parameter>.</para>
                        </step>
                        <step>
                            <para>Create a new key called
                            <parameter>ClientCertSubject</parameter></para>
                        </step>
                        <step>
                            <para>Enter the contents of the <parameter>subject_alt_name</parameter>
                                parameter (or the <parameter>Common Name</parameter> parameter if
                                the <parameter>subject_alt_name</parameter> parameter is empty).</para>
                            <note>
                                <para>A common way is to use the hostname or the IP address of the
                                    agent as the Common Name of the certificate (e.g.,
                                        <parameter>syslog-ng-agent1.example.com</parameter>).</para>
                            </note>
                        </step>
                    </substeps>
                </step>
            </procedure>
        </section>
    </section>

    <section id="windows_message_format_agent_2.1">
        <title>Customizing the message format</title>
        <para>The format of the messages received from the eventlog can be customized using macros.
            Besides the macros, you can use the following characters:
                <parameter>&lt;&gt;,():;-+/_</parameter>, and all alphanumeric characters.</para>
        <indexterm>
            <primary>timestamp</primary>
        </indexterm>
        <para>The syslog-ng agent can send the syslog messages using either the ISO or the BSD
            timestamp format. It is recommended to use the ISO format, because it contains much more
            information than the BSD format.</para>
        <xi:include href="chapter_reference.xml" xmlns:xi="http://www.w3.org/2001/XInclude"
            xpointer="element(date_macros)"/>
        <para>Note that in the syslog-ng agent, the macros without prefix (e.g.,
            <parameter>DATE</parameter>) always refer to the receiving date of the message (e.g.,
                <parameter>R_DATE</parameter>) when it arrived into the event log container, and are
            included only for compatibility reasons.</para>
        <warning>
            <indexterm>
                <primary>timezone</primary>
                <secondary>Windows</secondary>
            </indexterm>
            <indexterm>
                <primary>eventlog</primary>
                <secondary>remote logging</secondary>
            </indexterm>
            <para>If a remote host is logging into the event log of the local host that is running
                syslog-ng Agent for Windows, both hosts should be in the same timezone, because the
                event log message does not include the timezone information of the sender host.
                Otherwise, the date of the messages received from the remote host will be incorrect.
            </para>
        </warning>
        <para>The following table lists the available macros:</para>
        <table>
            <title>Macros of the syslog-ng agent</title>
            <indexterm>
                <primary>macros</primary>
                <secondary>syslog-ng agent</secondary>
            </indexterm>
            <tgroup cols="2">
                <thead>
                    <row>
                        <entry>Macro</entry>
                        <entry>Description</entry>
                    </row>
                </thead>
                <tbody>
                    <xi:include href="chapter_reference.xml"
                        xmlns:xi="http://www.w3.org/2001/XInclude" xpointer="element(macro_day)"/>
                    <row>
                        <entry>$EVENT_CATEGORY</entry>
                        <entry>The category of the event.</entry>
                    </row>
                    <row>
                        <entry>$EVENT_ID</entry>
                        <entry>The identification number of the event.</entry>
                    </row>
                    <row>
                        <entry>$EVENT_NAME</entry>
                        <entry>Name of the Windows event log container (e.g., Application or
                            Security).</entry>
                    </row>
                    <row>
                        <entry>$EVENT_SID</entry>
                        <entry>The security identification number of the event.</entry>
                    </row>
                    <row>
                        <entry>$EVENT_SID_TYPE</entry>
                        <entry>The security identification number resolved into name. One of the
                            following: <parameter>User</parameter>, <parameter>Group</parameter>,
                                <parameter>Domain</parameter>, <parameter>Alias</parameter>
                            <parameter>WellKnownGroup</parameter>,
                            <parameter>DeletedAccount</parameter>, <parameter>Invalid</parameter>,
                                <parameter>Unknown</parameter>, <parameter>Computer</parameter>.
                        </entry>
                    </row>
                    <row>
                        <entry>$EVENT_SOURCE</entry>
                        <entry>The application that created the message.</entry>
                    </row>
                    <row>
                        <entry>$EVENT_TYPE</entry>
                        <entry>The importance level of the message in text format.</entry>
                    </row>
                    <xi:include href="chapter_reference.xml"
                        xmlns:xi="http://www.w3.org/2001/XInclude"
                        xpointer="element(macro_facility)"/>
                    <xi:include href="chapter_reference.xml"
                        xmlns:xi="http://www.w3.org/2001/XInclude"
                        xpointer="element(macro_fulldate)"/>
                    <xi:include href="chapter_reference.xml"
                        xmlns:xi="http://www.w3.org/2001/XInclude" xpointer="element(macro_hour)"/>
                    <row>
                        <entry>$HOST</entry>
                        <entry>Name of the host sending the message.</entry>
                    </row>
                    <row>
                        <entry>ISODATE, R_ISODATE, S_ISODATE</entry>
                        <entry>Date of the message in the ISO 8601 compatible standard timestamp
                            format (yyyy-mm-ddThh:mm:ss+-ZONE), e.g.:
                                <parameter>2006-06-13T15:58:00.123+01:00</parameter>. If possible,
                            it is recommended to use <parameter>ISODATE</parameter> for
                            timestamping. Note that the syslog-ng agent cannot produce fractions of
                            a second (e.g., milliseconds) in the timestamp.</entry>
                    </row>
                    <row>
                        <entry>$LEVEL</entry>
                        <entry>Importance level of the message represented as a number: 6 - Success,
                            5 - Informational, 4- Warning, or 3 - Error).</entry>
                    </row>
                    <xi:include href="chapter_reference.xml"
                        xmlns:xi="http://www.w3.org/2001/XInclude" xpointer="element(macro_min)"/>
                    <xi:include href="chapter_reference.xml"
                        xmlns:xi="http://www.w3.org/2001/XInclude" xpointer="element(macro_month)"/>
                    <row id="macro_monthname">
                        <entry>MONTHNAME, R_MONTHNAME, S_MONTHNAME</entry>
                        <entry>The English name of the month the message was sent, abbreviated to
                            three characters (e.g., Jan, Feb, etc.). </entry>
                    </row>
                    <row>
                        <entry>$MSG</entry>
                        <entry>The content of the message.</entry>
                        <!-- FIXME ez ugyanaz, mint a $MSGONLY ?? -->
                    </row>
                    <row>
                        <entry>$PRI</entry>
                        <entry>Priority header of the message, storing the facility and the level of
                            the message.</entry>
                    </row>
                    <row>
                        <entry>$R_DATE</entry>
                        <entry>Date when the message was recorded into the eventlog container.
                        </entry>
                    </row>
                    <row>
                        <entry>$REC_NUM</entry>
                        <entry>The record number of the message in the event log.</entry>
                    </row>
                    <row>
                        <entry>$S_DATE</entry>
                        <entry>Date when the message was created.</entry>
                    </row>
                    <xi:include href="chapter_reference.xml"
                        xmlns:xi="http://www.w3.org/2001/XInclude" xpointer="element(macro_sec)"/>
                    <row>
                        <entry>TZ, R_TZ, S_TZ</entry>
                        <entry>The name of the time zone of the host. </entry>
                    </row>
                    <xi:include href="chapter_reference.xml"
                        xmlns:xi="http://www.w3.org/2001/XInclude"
                        xpointer="element(macro_tzoffset)"/>
                    <xi:include href="chapter_reference.xml"
                        xmlns:xi="http://www.w3.org/2001/XInclude"
                        xpointer="element(macro_unixtime)"/>
                    <row>
                        <entry>$USERNAME</entry>
                        <entry>The username running the application that created the
                        message.</entry>
                    </row>
                    <xi:include href="chapter_reference.xml"
                        xmlns:xi="http://www.w3.org/2001/XInclude" xpointer="element(macro_year)"/>
                    <xi:include href="chapter_reference.xml"
                        xmlns:xi="http://www.w3.org/2001/XInclude" xpointer="element(macro_week)"/>
                    <xi:include href="chapter_reference.xml"
                        xmlns:xi="http://www.w3.org/2001/XInclude" xpointer="element(macro_weekday)"
                    />
                </tbody>
            </tgroup>
        </table>
        <para>By default, the syslog-ng agent uses the following format:
                <parameter>&lt;${PRI}&gt;$DATE $HOST: ${USERNAME}: ${EVENT_NAME}
                ${EVENT_SOURCE}: [${EVENT_TYPE}] ${MSG} (EventID ${EVENT_ID}) </parameter>.</para>
    </section>

    <xi:include href="chapter_windows.xml" xmlns:xi="http://www.w3.org/2001/XInclude"
        xpointer="element(windows_service)"/>
    <xi:include href="chapter_windows.xml" xmlns:xi="http://www.w3.org/2001/XInclude"
        xpointer="element(windows_cpu)"/>
    <xi:include href="chapter_windows.xml" xmlns:xi="http://www.w3.org/2001/XInclude"
        xpointer="element(windows_auditing)"/>

</appendix>
