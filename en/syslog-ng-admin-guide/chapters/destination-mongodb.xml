<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE section SYSTEM "../../xml-stylesheet/pdf/dtd/docbookx.dtd"
 [  <!ENTITY % entities SYSTEM "../syslog-ng-entities.ent">
 %entities;]>
    <section id="configuring_destinations_mongodb" condition="ose">
        <title>Storing messages in a MongoDB database</title>
            <indexterm>
                <primary>destination drivers</primary>
                <secondary><parameter>mongodb()</parameter> driver</secondary>
            </indexterm>
            <para>The <parameter>mongodb()</parameter> driver sends messages to a MongoDB database. MongoDB is a schema-free, document-oriented database. For the list of available optional parameters, see <xref linkend="reference_destination_mongodb"/>.</para>
            <synopsis>Declaration:
                mongodb(parameters);</synopsis>
            <para>The <parameter>mongodb()</parameter> driver does not support creating indexes, as that can be a very complex operation in MongoDB. If needed, the administrator of the MongoDB database must ensure that indexes are created on the collections.</para>
            <example id="example_destination_mongodb">
                <title>Using the mongodb() driver</title>
                <para>The following example creates a <parameter>mongodb()</parameter> destination using only default values.</para>
                <synopsis>destination d_mongodb {
    mongodb();
};</synopsis>
                <para>The following example displays the default values, and is equivalent with the previous example.</para>
                <synopsis>destination d_mongodb {
    mongodb(
        host("localhost")
        port(27017)
        database("syslog")
        collection("messages")
        value-pairs(
            scope("selected-macros" "nv-pairs")
            exclude("R_*")
            exclude("S_*")
            exclude("HOST_FROM")
            exclude("LEGACY_MSGHDR")
            exclude("MSG")
            exclude("SDATA")
        )
    );
};</synopsis>
            </example>
            <section id="reference_destination_mongodb" condition="ose">
                <title>mongodb() destination options</title>
                <indexterm>
                    <primary>destination drivers</primary>
                    <secondary><parameter>mongodb()</parameter> driver</secondary>
                </indexterm>
                <para>The <parameter>mongodb()</parameter> driver sends messages to a MongoDB database. MongoDB is a schema-free, document-oriented database.</para>
                <para>The <parameter>mongodb()</parameter> destination has the following options:</para>
                <simplesect id="mongodb_option_collection">
                    <title>collection()</title>
                        <indexterm type="parameter">
                            <primary>collection()</primary>
                        </indexterm>
                    <informaltable frame="topbot" colsep="0" rowsep="0">
                        <tgroup cols="2">
                            <colspec colnum="1" colwidth="40pt"/>
                            <tbody>
                                <row>
                                    <entry>Type:
                                        <?dbhtml bgcolor="#D4D6EB" ?><?dbfo bgcolor="#D4D6EB" ?></entry>
                                    <entry>string</entry>
                                </row>
                                <row>
                                    <entry>Default:
                                        <?dbhtml bgcolor="#D4D6EB" ?><?dbfo bgcolor="#D4D6EB" ?></entry>
                                    <entry>messages</entry>
                                </row>
                            </tbody>
                        </tgroup>
                    </informaltable>
                    <para><guilabel>Description:</guilabel> The name of the MongoDB collection where the log messages are stored (collections are similar to SQL tables). Note that the name of the collection must not start with a dollar sign ($), and that it may contain dot (.) characters.</para>
                    <warning>
                        <para>Hazard of data loss! The &abbrev; application does not verify that the specified collection name does not contain invalid characters. If you specify a collection with an invalid name, the log messages sent to the MongoDB database will be irrevocably lost without any warning.</para>
                    </warning>
                </simplesect>
                <simplesect id="mongodb_option_database">
                    <title>database()</title>
                        <indexterm type="parameter">
                            <primary>database()</primary>
                        </indexterm>
                    <informaltable frame="topbot" colsep="0" rowsep="0">
                        <tgroup cols="2">
                            <colspec colnum="1" colwidth="40pt"/>
                            <tbody>
                                <row>
                                    <entry>Type:
                                        <?dbhtml bgcolor="#D4D6EB" ?><?dbfo bgcolor="#D4D6EB" ?></entry>
                                    <entry>string</entry>
                                </row>
                                <row>
                                    <entry>Default:
                                        <?dbhtml bgcolor="#D4D6EB" ?><?dbfo bgcolor="#D4D6EB" ?></entry>
                                    <entry>syslog</entry>
                                </row>
                            </tbody>
                        </tgroup>
                    </informaltable>
                    <para><guilabel>Description:</guilabel> The name of the MongoDB database where the log messages are stored. Note that the name of the database must not start with a dollar sign ($) and it cannot contain dot (.) characters.</para>
                    <warning>
                        <para>Hazard of data loss! The &abbrev; application does not verify that the specified database name does not contain invalid characters. If you specify a database with an invalid name, the log messages sent to the MongoDB database will be irrevocably lost without any warning.</para>
                    </warning>
                </simplesect>
                <simplesect>
					<xi:include href="reference_common.xml" xpointer="xpointer(//simplesect[@id = 'destination_commonoption_frac_digits']/node() )" xmlns:xi="http://www.w3.org/2001/XInclude"/>
				</simplesect>
                <simplesect>
                    <title>host()</title>
                    <indexterm type="parameter">
                        <primary>host()</primary>
                    </indexterm>
                    <informaltable frame="topbot" colsep="0" rowsep="0">
                        <tgroup cols="2">
                        <colspec colnum="1" colwidth="40pt"/>
                            <tbody>
                                <row>
                                    <entry>Type:
                                        <?dbhtml bgcolor="#D4D6EB" ?><?dbfo bgcolor="#D4D6EB" ?></entry>
                                    <entry>hostname or IP address</entry>
                                </row>
                                <row>
                                    <entry>Default:
                                        <?dbhtml bgcolor="#D4D6EB" ?><?dbfo bgcolor="#D4D6EB" ?></entry>
                                    <entry>localhost</entry>
                                </row>
                            </tbody>
                        </tgroup>
                    </informaltable>
                    <para><guilabel>Description:</guilabel> Hostname or IP address of the database server. When specifying an IP address, IPv4 (for example, <parameter>192.168.0.1</parameter>) or IPv6 (for example, <parameter>[::1]</parameter>) can be used as well.</para>
                    <note>
                        <para>If you specify <parameter>host="localhost"</parameter> (or use the default), &abbrev; will use a socket to connect to the local database server. Use <parameter>host="127.0.0.1"</parameter> to force TCP communication between &abbrev; and the local database server.</para>
                    </note>
                </simplesect>
                <simplesect>
					<xi:include href="reference_common.xml" xpointer="xpointer(//simplesect[@id = 'destination_commonoption_log_fifo_size']/node() )" xmlns:xi="http://www.w3.org/2001/XInclude"/>
				</simplesect>
                <simplesect id="mongodb_option_port">
	                <title>port()</title>
	                <indexterm type="parameter">
	                    <primary>port()</primary>
	                </indexterm>
	                <informaltable frame="topbot" colsep="0" rowsep="0">
	                    <tgroup cols="2">
	                    <colspec colnum="1" colwidth="40pt"/>
	                        <tbody>
	                            <row>
	                                <entry>Type:
	                                    <?dbhtml bgcolor="#D4D6EB" ?><?dbfo bgcolor="#D4D6EB" ?></entry>
	                                <entry>number</entry>
	                            </row>
	                            <row>
	                                <entry>Default:
	                                    <?dbhtml bgcolor="#D4D6EB" ?><?dbfo bgcolor="#D4D6EB" ?></entry>
	                                <entry>27017</entry>
	                            </row>
	                        </tbody>
	                    </tgroup>
	                </informaltable>
	                <para><guilabel>Description:</guilabel> The port number to connect to.</para>
	            </simplesect>
                <simplesect>
                    <xi:include href="reference_common.xml" xpointer="xpointer(//simplesect[@id = 'destination_commonoption_timezone']/node() )" xmlns:xi="http://www.w3.org/2001/XInclude"/>
                </simplesect>
                <simplesect id="mongodb_option_value_pairs">
	                <title>value-pairs()</title>
	                <indexterm type="parameter">
	                    <primary>value-pairs()</primary>
	                </indexterm>
	                <informaltable frame="topbot" colsep="0" rowsep="0">
	                    <tgroup cols="2">
	                    <colspec colnum="1" colwidth="40pt"/>
	                        <tbody>
	                            <row>
	                                <entry>Type:
	                                    <?dbhtml bgcolor="#D4D6EB" ?><?dbfo bgcolor="#D4D6EB" ?></entry>
	                                <entry>parameter list of the <parameter>value-pairs()</parameter> option</entry>
	                            </row>
	                            <row>
	                                <entry>Default:
	                                    <?dbhtml bgcolor="#D4D6EB" ?><?dbfo bgcolor="#D4D6EB" ?></entry>
	                                <entry><synopsis>scope("selected-macros" "nv-pairs")
      exclude("R_*")
      exclude("S_*")
      exclude("HOST_FROM")
      exclude("LEGACY_MSGHDR")
      exclude("MSG")
      exclude("SDATA")</synopsis></entry>
	                            </row>
	                        </tbody>
	                    </tgroup>
	                </informaltable>
	                <para><guilabel>Description:</guilabel> The <parameter>value-pairs()</parameter> option creates structured name-value pairs from the data and metadata of the log message. For details on using <parameter>value-pairs()</parameter>, see <xref linkend="concepts-value-pairs"/>.</para>
                    <note>
                        <para>Empty keys are not logged.</para>
                    </note>
	            </simplesect>
            </section>
        </section>
